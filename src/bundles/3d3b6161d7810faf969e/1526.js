"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[1526],{"./src/components/views/rooms/wysiwyg_composer/ComposerContext.ts":(e,t,o)=>{o.d(t,{AP:()=>c,EW:()=>i,Hx:()=>a});var n=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=o("./node_modules/react/index.js");function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function c(e){return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){(0,n.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({selection:{anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isForward:!0}},e)}const i=(0,r.createContext)(c());function a(){return(0,r.useContext)(i)}i.displayName="ComposerContext"},"./src/components/views/rooms/wysiwyg_composer/components/Editor.tsx":(e,t,o)=>{o.d(t,{K:()=>d});var n=o("./node_modules/classnames/index.js"),r=o.n(n),s=o("./node_modules/react/index.js");var c=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=o("./src/hooks/useFocus.ts"),a=o("./src/components/views/rooms/wysiwyg_composer/ComposerContext.ts");function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function m(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,c.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function u(e){const t=document.getSelection();if(t){const o=t.getRangeAt(0),n=o.startContainer===t.anchorNode&&o.startOffset===t.anchorOffset;e.selection={anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset,isForward:n}}}const d=(0,s.memo)((0,s.forwardRef)((function({disabled:e,placeholder:t,leftComponent:o,rightComponent:n},c){const l=function(e,t){const[o,n]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{if(e.current){const o=e.current,r=new ResizeObserver((e=>{requestAnimationFrame((()=>{var o;const r=null===(o=e[0])||void 0===o||null===(o=o.contentBoxSize)||void 0===o?void 0:o[0].blockSize;n(r>=t)}))}));return r.observe(o),()=>r.unobserve(o)}}),[e,t]),o}(c,24),{onFocus:d,onBlur:p,onInput:f}=function(){const e=(0,a.Hx)(),[t,o]=(0,i.A)();(0,s.useEffect)((()=>{function o(){u(e)}return t&&document.addEventListener("selectionchange",o),()=>document.removeEventListener("selectionchange",o)}),[t,e]);const n=(0,s.useCallback)((()=>{u(e)}),[e]);return m(m({},o),{},{onInput:n})}();return s.createElement("div",{className:"mx_WysiwygComposer_Editor","data-is-expanded":l},o,s.createElement("div",{className:"mx_WysiwygComposer_Editor_container"},s.createElement("div",{className:r()("mx_WysiwygComposer_Editor_content",{mx_WysiwygComposer_Editor_content_placeholder:Boolean(t)}),style:{"--placeholder":`"${t}"`},ref:c,contentEditable:!e,role:"textbox","aria-multiline":"true","aria-autocomplete":"list","aria-haspopup":"listbox",dir:"auto","aria-disabled":e,onFocus:d,onBlur:p,onInput:f})),n)})))},"./src/components/views/rooms/wysiwyg_composer/components/WysiwygAutocomplete.tsx":(e,t,o)=>{o.d(t,{W:()=>d});var n=o("./node_modules/react/index.js"),r=o("./node_modules/matrix-js-sdk/src/logger.ts"),s=o("./src/components/views/rooms/Autocomplete.tsx"),c=o("./src/contexts/MatrixClientContext.tsx"),i=o("./src/Avatar.ts");function a(e,t){const o=e.completionId,n=e.completion;let r;return r=o?t.getRoom(o):n.startsWith("#")?t.getRooms().find((e=>e.getCanonicalAlias()===n||e.getAltAliases().includes(n))):t.getRoom(n),null!=r?r:null}function l({url:e,initialLetter:t,id:o=""}){const n=[`--avatar-background: url(${e})`,`--avatar-letter: '${t}'`],r=i.gx(o);return r&&n.push(r),n.join("; ")}function m(e,t,o){const n="â€‹",r=new Map;if("user"===e.type){const t=o.getMember(e.completionId||"");if(!t)return r;const c=t.name||t.userId,a=i.iv(t.userId),m=i._V(t,16,16,"crop");let u=n;var s;if(m===a)u=null!==(s=i.$R(c))&&void 0!==s?s:n;r.set("data-mention-type",e.type),r.set("style",l({url:m,initialLetter:u,id:t.userId}))}else if("room"===e.type){var c;const o=a(e,t),s=e.completion;let d=n,p=i.ze(null!=o?o:null,16,16,"crop");var m,u;if(!p)d=null!==(m=i.$R((null==o?void 0:o.name)||s))&&void 0!==m?m:n,p=i.iv(null!==(u=null==o?void 0:o.roomId)&&void 0!==u?u:s);r.set("data-mention-type",e.type),r.set("style",l({url:p,initialLetter:d,id:null!==(c=null==o?void 0:o.roomId)&&void 0!==c?c:s}))}else if("at-room"===e.type){let t=n,s=i.ze(o,16,16,"crop");var d;if(!s)t=null!==(d=i.$R(o.name))&&void 0!==d?d:n,s=i.iv(o.roomId);r.set("data-mention-type",e.type),r.set("style",l({url:s,initialLetter:t,id:o.roomId}))}return r}var u=o("./src/contexts/ScopedRoomContext.tsx");const d=(0,n.forwardRef)((({suggestion:e,handleMention:t,handleCommand:o,handleAtRoomMention:i},l)=>{const{room:d}=(0,u.ME)("room"),p=(0,c.nH)();if(!d)return null;const f=function(e){return e&&e.keyChar?`${e.keyChar}${e.text}`:""}(e);return r.v.log(`## 26037 ## Rendering Autocomplete for WysiwygAutocomplete with query: "${f}"`),n.createElement("div",{className:"mx_WysiwygComposer_AutoCompleteWrapper"},n.createElement(s.A,{ref:l,query:f,onConfirm:function(e){if(void 0!==p&&void 0!==d)switch(e.type){case"command":return void o(e.completion.trim());case"at-room":return void i(m(e,p,d));case"room":case"user":return void("string"==typeof e.href&&t(e.href,function(e,t){return"user"===e.type||"at-room"===e.type?e.completion:"room"===e.type?(null===(o=a(e,t))||void 0===o?void 0:o.name)||e.completion:"";var o}(e,p),m(e,p,d)));default:return}},selection:{start:0,end:0},room:d}))}));d.displayName="WysiwygAutocomplete"},"./src/components/views/rooms/wysiwyg_composer/components/WysiwygComposer.tsx":(e,t,o)=>{o.d(t,{k:()=>pe});var n=o("./node_modules/react/index.js"),r=o("./node_modules/@matrix-org/emojibase-bindings/build/emoji.js"),s=o("./node_modules/@vector-im/matrix-wysiwyg/dist/matrix-wysiwyg.js"),c=o("./node_modules/classnames/index.js"),i=o.n(c),a=o("./src/components/views/rooms/wysiwyg_composer/components/WysiwygAutocomplete.tsx"),l=o("./node_modules/react/jsx-runtime.js");function m(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M8.8 19c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 6.8 17V7c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 8.8 5h3.525c1.083 0 2.083.333 3 1 .917.667 1.375 1.592 1.375 2.775 0 .85-.192 1.504-.575 1.963-.383.458-.742.787-1.075.987.417.183.88.525 1.387 1.025.509.5.763 1.25.763 2.25 0 1.483-.542 2.52-1.625 3.113-1.083.591-2.1.887-3.05.887H8.8Zm1.025-2.8h2.6c.8 0 1.287-.204 1.462-.612.175-.409.263-.705.263-.888 0-.183-.088-.48-.263-.887-.175-.409-.687-.613-1.537-.613H9.825v3Zm0-5.7h2.325c.55 0 .95-.142 1.2-.425a1.4 1.4 0 0 0 .375-.95c0-.4-.142-.725-.425-.975-.283-.25-.65-.375-1.1-.375H9.825V10.5Z"})})}m.displayName="BoldIcon";const u=(0,n.forwardRef)(m);function d(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M4.5 7.5a1.45 1.45 0 0 1-1.06-.44A1.444 1.444 0 0 1 3 6c0-.412.147-.766.44-1.06A1.45 1.45 0 0 1 4.5 4.5c.412 0 .766.147 1.06.44.293.294.44.647.44 1.06 0 .412-.147.766-.44 1.06-.294.293-.647.44-1.06.44Zm4.787 11.212c.192.192.43.288.713.288h10c.283 0 .52-.096.712-.288A.968.968 0 0 0 21 18a.968.968 0 0 0-.288-.712A.968.968 0 0 0 20 17H10a.967.967 0 0 0-.713.288A.968.968 0 0 0 9 18c0 .283.096.52.287.712Zm0-5.999c.192.191.43.287.713.287h10a.97.97 0 0 0 .712-.287A.968.968 0 0 0 21 12a.968.968 0 0 0-.288-.713A.968.968 0 0 0 20 11H10a.967.967 0 0 0-.713.287A.968.968 0 0 0 9 12c0 .283.096.52.287.713Zm0-6c.192.191.43.287.713.287h10a.97.97 0 0 0 .712-.287A.967.967 0 0 0 21 6a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 5H10a.968.968 0 0 0-.713.287A.968.968 0 0 0 9 6c0 .283.096.52.287.713ZM3.44 19.06c.294.293.648.44 1.06.44a1.45 1.45 0 0 0 1.06-.44c.293-.294.44-.647.44-1.06 0-.413-.147-.766-.44-1.06a1.445 1.445 0 0 0-1.06-.44 1.45 1.45 0 0 0-1.06.44c-.293.294-.44.647-.44 1.06 0 .413.147.766.44 1.06ZM4.5 13.5a1.45 1.45 0 0 1-1.06-.44A1.445 1.445 0 0 1 3 12c0-.412.147-.766.44-1.06a1.45 1.45 0 0 1 1.06-.44c.412 0 .766.147 1.06.44.293.294.44.648.44 1.06 0 .412-.147.766-.44 1.06-.294.293-.647.44-1.06.44Z"})})}d.displayName="ListBulletedIcon";const p=(0,n.forwardRef)(d);function f(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"m8.825 12 1.475-1.475c.2-.2.3-.433.3-.7 0-.267-.1-.5-.3-.7-.2-.2-.438-.3-.713-.3-.274 0-.512.1-.712.3L6.7 11.3c-.1.1-.17.208-.213.325a1.107 1.107 0 0 0-.062.375c0 .133.02.258.063.375a.877.877 0 0 0 .212.325l2.175 2.175c.2.2.438.3.713.3.275 0 .512-.1.712-.3.2-.2.3-.433.3-.7 0-.267-.1-.5-.3-.7L8.825 12Zm6.35 0L13.7 13.475c-.2.2-.3.433-.3.7 0 .267.1.5.3.7.2.2.438.3.713.3.274 0 .512-.1.712-.3L17.3 12.7c.1-.1.17-.208.212-.325.042-.117.063-.242.063-.375s-.02-.258-.063-.375a.877.877 0 0 0-.212-.325l-2.175-2.175a.999.999 0 0 0-1.425 0c-.2.2-.3.433-.3.7 0 .267.1.5.3.7L15.175 12ZM5 21c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 3 19V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 5 3h14c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v14c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 19 21H5Zm0-2h14V5H5v14Z"})})}f.displayName="CodeIcon";const g=(0,n.forwardRef)(f);function h(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M3.288 18.712A.965.965 0 0 0 4 19h16c.283 0 .52-.096.712-.288A.968.968 0 0 0 21 18a.968.968 0 0 0-.288-.712A.968.968 0 0 0 20 17H4a.967.967 0 0 0-.712.288A.968.968 0 0 0 3 18c0 .283.096.52.288.712Zm7.999-3.999c.192.191.43.287.713.287h8a.97.97 0 0 0 .712-.287A.968.968 0 0 0 21 14a.968.968 0 0 0-.288-.713A.968.968 0 0 0 20 13h-8a.968.968 0 0 0-.713.287A.968.968 0 0 0 11 14c0 .283.096.52.287.713Zm0-4c.192.191.43.287.713.287h8a.97.97 0 0 0 .712-.287A.968.968 0 0 0 21 10a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 9h-8a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 10c0 .283.096.52.287.713Zm0-4c.192.191.43.287.713.287h8a.97.97 0 0 0 .712-.287A.967.967 0 0 0 21 6a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 5h-8a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 6c0 .283.096.52.287.713ZM6.15 13.15l-2.8-2.8a.48.48 0 0 1 0-.7l2.8-2.8c.167-.167.35-.208.55-.125.2.083.3.242.3.475v5.6c0 .233-.1.392-.3.475-.2.083-.383.042-.55-.125Z"})})}h.displayName="IndentDecreaseIcon";const v=(0,n.forwardRef)(h);function y(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M4 19a.967.967 0 0 1-.712-.288A.968.968 0 0 1 3 18c0-.283.096-.52.288-.712A.967.967 0 0 1 4 17h16c.283 0 .52.096.712.288.192.191.288.429.288.712s-.096.52-.288.712A.968.968 0 0 1 20 19H4Zm8-4a.968.968 0 0 1-.713-.287A.968.968 0 0 1 11 14c0-.283.096-.52.287-.713A.968.968 0 0 1 12 13h8a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 20 15h-8Zm0-4a.968.968 0 0 1-.713-.287A.968.968 0 0 1 11 10c0-.283.096-.52.287-.713A.968.968 0 0 1 12 9h8a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 20 11h-8Zm0-4a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 6c0-.283.096-.52.287-.713A.968.968 0 0 1 12 5h8a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 20 7h-8Zm-8.15 6.15c-.167.167-.35.208-.55.125-.2-.083-.3-.242-.3-.475V7.2c0-.233.1-.392.3-.475.2-.083.383-.042.55.125l2.8 2.8a.48.48 0 0 1 0 .7l-2.8 2.8Z"})})}y.displayName="IndentIncreaseIcon";const w=(0,n.forwardRef)(y);function b(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M14.958 5.62a1 1 0 0 0-1.916-.574l-4 13.333a1 1 0 0 0 1.916.575l4-13.333ZM5.974 7.232a1 1 0 0 0-1.409.128l-3.333 4a1 1 0 0 0 0 1.28l3.333 4a1 1 0 1 0 1.537-1.28L3.302 12l2.8-3.36a1 1 0 0 0-.128-1.408Zm12.052 0a1 1 0 0 1 1.409.128l3.333 4a1 1 0 0 1 0 1.28l-3.333 4a1 1 0 1 1-1.537-1.28l2.8-3.36-2.8-3.36a1 1 0 0 1 .128-1.408Z"})})}b.displayName="InlineCodeIcon";const x=(0,n.forwardRef)(b);function _(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M6.25 19c-.35 0-.646-.12-.888-.363A1.207 1.207 0 0 1 5 17.75c0-.35.12-.646.362-.887.242-.242.538-.363.888-.363H9l3-9H9.25c-.35 0-.646-.12-.887-.362A1.207 1.207 0 0 1 8 6.25c0-.35.12-.646.363-.888A1.21 1.21 0 0 1 9.25 5h7.5c.35 0 .646.12.887.362.242.242.363.538.363.888s-.12.646-.363.888a1.207 1.207 0 0 1-.887.362H14.5l-3 9h2.25c.35 0 .646.12.887.363.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 0 1-.887.363h-7.5Z"})})}_.displayName="ItalicIcon";const E=(0,n.forwardRef)(_);function C(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M9 6a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H10a1 1 0 0 1-1-1Zm0 6a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H10a1 1 0 0 1-1-1Zm0 6a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H10a1 1 0 0 1-1-1ZM5.604 5.089A.75.75 0 0 1 6 5.75v4.5a.75.75 0 0 1-1.5 0V7.151l-.334.223a.75.75 0 0 1-.832-1.248l1.5-1a.75.75 0 0 1 .77-.037ZM5 13a2.02 2.02 0 0 0-1.139.321 1.846 1.846 0 0 0-.626.719 2.286 2.286 0 0 0-.234.921v.023l-.001.01v.005l.75.001H3a.75.75 0 0 0 1.5.01V15a.789.789 0 0 1 .077-.29.35.35 0 0 1 .116-.14c.04-.027.126-.07.307-.07s.267.043.307.07a.35.35 0 0 1 .116.14.788.788 0 0 1 .076.29v.008a.532.532 0 0 1-.14.352l-2.161 2.351a.748.748 0 0 0-.198.523v.016c0 .414.336.75.75.75h2.5a.75.75 0 0 0 0-1.5h-.82l1.034-1.124C6.809 16 7 15.51 7 15h-.75H7v-.039l-.004-.068a2.285 2.285 0 0 0-.231-.853 1.846 1.846 0 0 0-.626-.719A2.02 2.02 0 0 0 5 13Zm-.5 2.003V15v.01-.008Z"})})}C.displayName="ListNumberedIcon";const A=(0,n.forwardRef)(C);function k(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M4.719 4.34c.094-.642-.366-1.236-1.028-1.328-.663-.092-1.276.354-1.371.996l-.808 5.478c-.094.642.366 1.237 1.028 1.328.663.092 1.276-.354 1.371-.996l.808-5.478Zm12.115 10.174c.095-.642-.366-1.237-1.028-1.328-.662-.092-1.276.354-1.37.996l-.809 5.478c-.094.642.366 1.236 1.028 1.328.663.092 1.277-.354 1.371-.996l.808-5.478ZM9.318 3.009c.665.077 1.138.662 1.058 1.306l-.022.175a220.467 220.467 0 0 1-.266 2.006c-.161 1.171-.368 2.579-.535 3.386-.13.636-.769 1.049-1.425.921-.656-.127-1.082-.745-.95-1.381.148-.72.345-2.052.509-3.237a190.652 190.652 0 0 0 .262-1.981l.021-.17c.08-.644.684-1.103 1.348-1.025Zm13.17 11.505c.094-.642-.366-1.237-1.028-1.328-.663-.092-1.276.354-1.371.996l-.808 5.478c-.094.642.366 1.236 1.028 1.328.663.092 1.276-.354 1.371-.996l.808-5.478Z"})})}k.displayName="QuoteIcon";const O=(0,n.forwardRef)(k);function j(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M12.15 20c-1.267 0-2.392-.375-3.375-1.125-.983-.75-1.692-1.775-2.125-3.075l2.2-.95c.233.8.638 1.458 1.213 1.975.574.517 1.287.775 2.137.775.7 0 1.333-.167 1.9-.5.567-.333.85-.867.85-1.6 0-.3-.058-.575-.175-.825A2.362 2.362 0 0 0 14.3 14h2.8a4.279 4.279 0 0 1 .25 1.5c0 1.433-.513 2.542-1.538 3.325C14.788 19.608 13.567 20 12.15 20ZM3 12a.967.967 0 0 1-.712-.287A.968.968 0 0 1 2 11c0-.283.096-.52.288-.712A.967.967 0 0 1 3 10h18c.283 0 .52.096.712.288.192.191.288.429.288.712s-.096.52-.288.713A.968.968 0 0 1 21 12H3Zm9.05-8.15c1.1 0 2.063.27 2.887.813.825.541 1.463 1.37 1.913 2.487l-2.2.975a2.987 2.987 0 0 0-.838-1.3c-.408-.383-.979-.575-1.712-.575-.683 0-1.25.154-1.7.463-.45.308-.7.737-.75 1.287h-2.4c.033-1.15.487-2.13 1.363-2.937.875-.809 2.02-1.213 3.437-1.213Z"})})}j.displayName="StrikethroughIcon";const N=(0,n.forwardRef)(j);function S(e,t){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,l.jsx)("path",{d:"M6 21a.967.967 0 0 1-.713-.288A.968.968 0 0 1 5 20a.97.97 0 0 1 .287-.712A.967.967 0 0 1 6 19h12c.283 0 .52.096.712.288.192.191.288.429.288.712s-.096.52-.288.712A.968.968 0 0 1 18 21H6Zm6-4c-1.683 0-2.992-.525-3.925-1.575-.933-1.05-1.4-2.442-1.4-4.175V4.275c0-.35.13-.65.388-.9A1.27 1.27 0 0 1 7.974 3c.35 0 .65.125.9.375s.375.55.375.9V11.4c0 .933.233 1.692.7 2.275.467.583 1.15.875 2.05.875.9 0 1.583-.292 2.05-.875.467-.583.7-1.342.7-2.275V4.275c0-.35.13-.65.387-.9A1.27 1.27 0 0 1 16.05 3c.35 0 .65.125.9.375s.375.55.375.9v6.975c0 1.733-.467 3.125-1.4 4.175C14.992 16.475 13.683 17 12 17Z"})})}S.displayName="UnderlineIcon";const I=(0,n.forwardRef)(S);var M=o("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/link.js"),R=o("./src/languageHandler.tsx"),T=o("./src/components/views/elements/AccessibleButton.tsx"),B=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),P=o("./src/Modal.tsx"),F=o("./src/components/views/elements/Field.tsx"),Z=o("./src/components/views/rooms/wysiwyg_composer/utils/selection.ts"),L=o("./src/components/views/dialogs/BaseDialog.tsx"),H=o("./src/components/views/elements/DialogButtons.tsx");function D(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function K(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?D(Object(o),!0).forEach((function(t){(0,B.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):D(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function W(e){return e.length<1}const V=({composer:e,isTextEnabled:t,onFinished:o,composerContext:r,isEditing:s})=>{const[c,i]=(0,n.useState)(!1),[a,l]=(0,n.useState)({text:"",link:s?e.getLink():""}),m=!s&&t,u=!c||m&&W(a.text)||W(a.link);return n.createElement(L.A,{className:"mx_LinkModal",title:s?(0,R._t)("composer|link_modal|title_edit"):(0,R._t)("composer|link_modal|title_create"),hasCancel:!0,onFinished:o},n.createElement("form",{className:"mx_LinkModal_content",onSubmit:async n=>{n.preventDefault(),n.stopPropagation(),o(),await new Promise((e=>setTimeout(e,0))),await(0,Z.td)(r.selection),e.link(a.link,t?a.text:void 0)}},m&&n.createElement(F.A,{required:!0,autoFocus:!0,label:(0,R._t)("composer|link_modal|text_field_label"),value:a.text,className:"mx_LinkModal_Field",placeholder:"",onChange:e=>l((t=>K(K({},t),{},{text:e.target.value})))}),n.createElement(F.A,{required:!0,autoFocus:!m,label:(0,R._t)("composer|link_modal|link_field_label"),value:a.link,className:"mx_LinkModal_Field",placeholder:"",onChange:e=>{l((t=>K(K({},t),{},{link:e.target.value}))),i(!0)}}),n.createElement("div",{className:"mx_LinkModal_buttons"},s&&n.createElement("button",{type:"button",className:"danger",onClick:()=>{e.removeLinks(),o()}},(0,R._t)("action|remove")),n.createElement(H.A,{primaryButton:(0,R._t)("action|save"),primaryDisabled:u,primaryIsSubmit:!0,onCancel:o}))))};var z=o("./src/components/views/rooms/wysiwyg_composer/ComposerContext.ts"),q=o("./src/components/views/settings/KeyboardShortcut.tsx");function U({label:e,keyCombo:t,onClick:o,actionState:r,icon:s}){return n.createElement(T.A,{element:"button",onClick:o,"aria-label":e,className:i()("mx_FormattingButtons_Button",{mx_FormattingButtons_active:"reversed"===r,mx_FormattingButtons_Button_hover:"enabled"===r,mx_FormattingButtons_disabled:"disabled"===r}),title:"disabled"===r?void 0:e,caption:t&&n.createElement(q.S,{value:t,className:"mx_FormattingButtons_Tooltip_KeyboardShortcut"}),placement:"top"},s)}function $({composer:e,actionStates:t}){const o=(0,z.Hx)(),r="reversed"===t.unorderedList||"reversed"===t.orderedList;return n.createElement("div",{className:"mx_FormattingButtons"},n.createElement(U,{actionState:t.bold,label:(0,R._t)("composer|format_bold"),keyCombo:{ctrlOrCmdKey:!0,key:"b"},onClick:()=>e.bold(),icon:n.createElement(u,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.italic,label:(0,R._t)("composer|format_italic"),keyCombo:{ctrlOrCmdKey:!0,key:"i"},onClick:()=>e.italic(),icon:n.createElement(E,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.underline,label:(0,R._t)("composer|format_underline"),keyCombo:{ctrlOrCmdKey:!0,key:"u"},onClick:()=>e.underline(),icon:n.createElement(I,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.strikeThrough,label:(0,R._t)("composer|format_strikethrough"),onClick:()=>e.strikeThrough(),icon:n.createElement(N,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.unorderedList,label:(0,R._t)("composer|format_unordered_list"),onClick:()=>e.unorderedList(),icon:n.createElement(p,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.orderedList,label:(0,R._t)("composer|format_ordered_list"),onClick:()=>e.orderedList(),icon:n.createElement(A,{className:"mx_FormattingButtons_Icon"})}),r&&n.createElement(U,{actionState:t.indent,label:(0,R._t)("composer|format_increase_indent"),onClick:()=>e.indent(),icon:n.createElement(w,{className:"mx_FormattingButtons_Icon"})}),r&&n.createElement(U,{actionState:t.unindent,label:(0,R._t)("composer|format_decrease_indent"),onClick:()=>e.unindent(),icon:n.createElement(v,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.quote,label:(0,R._t)("action|quote"),onClick:()=>e.quote(),icon:n.createElement(O,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.inlineCode,label:(0,R._t)("composer|format_inline_code"),keyCombo:{ctrlOrCmdKey:!0,key:"e"},onClick:()=>e.inlineCode(),icon:n.createElement(x,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.codeBlock,label:(0,R._t)("composer|format_code_block"),onClick:()=>e.codeBlock(),icon:n.createElement(g,{className:"mx_FormattingButtons_Icon"})}),n.createElement(U,{actionState:t.link,label:(0,R._t)("composer|format_link"),onClick:()=>function(e,t,o){P.Ay.createDialog(V,{composerContext:t,composer:e,isTextEnabled:(0,Z.CD)(),isEditing:o},"mx_CompoundDialog",!1,!0)}(e,o,"reversed"===t.link),icon:n.createElement(M.A,{className:"mx_FormattingButtons_Icon"})}))}var Y=o("./src/components/views/rooms/wysiwyg_composer/components/Editor.tsx"),J=o("./src/hooks/useSettings.ts"),Q=o("./src/KeyBindingsManager.ts"),G=o("./src/accessibility/KeyboardShortcuts.ts"),X=o("./src/utils/EventUtils.ts"),ee=o("./src/dispatcher/dispatcher.ts"),te=o("./src/dispatcher/actions.ts"),oe=o("./src/contexts/MatrixClientContext.tsx"),ne=o("./node_modules/matrix-js-sdk/src/matrix.ts");var re=o("./src/components/views/rooms/wysiwyg_composer/utils/editing.ts"),se=o("./src/components/views/rooms/wysiwyg_composer/hooks/utils.ts"),ce=o("./src/contexts/ScopedRoomContext.tsx");function ie(e,t,o,r){const s=(0,ce.ME)("liveTimeline","room","replyToEvent","timelineRenderingType"),c=(0,z.Hx)(),i=(0,oe.nH)(),a=(0,J.ti)("MessageComposerInput.ctrlEnterToSend");return(0,n.useCallback)(((n,l,m)=>{const u=()=>{var o,r;null===(o=n.stopPropagation)||void 0===o||o.call(n),null===(r=n.preventDefault)||void 0===r||r.call(n),null!=t&&t.current&&!t.current.state.hide||e()};if((0,se.wg)(n)){const e=n instanceof ClipboardEvent?n.clipboardData:n.dataTransfer;return(0,se.VI)(n,e,s,i,r)?null:n}return n instanceof KeyboardEvent?function(e,t,o,n,r,s,c,i,a){const{editorStateTransfer:l}=c,m=Boolean(l)?o!==n.content():0!==n.content().length,u=(0,Q.zM)().getMessageComposerAction(e),d=(0,se.hi)(a,e);if(d)return e;if(void 0===i)return null;switch(u){case G.bY.SendMessage:return t(),null;case G.bY.EditPrevMessage:if(!(0,Z.tJ)(r)||m)break;if(ae(e,!1,l,c,s,i))return null;break;case G.bY.EditNextMessage:if(!l||!(0,Z.uJ)(r)||m)break;return ae(e,!0,l,c,s,i)||((0,re.w)(s),e.preventDefault(),e.stopPropagation()),null}return e}(n,u,o,l,m,s,c,i,t):function(e,t,o){switch(e.inputType){case"insertParagraph":if(!o)return t(),null;break;case"sendMessage":if(o)return t(),null}return e}(n,u,a)}),[a,e,o,s,c,i,t,r])}function ae(e,t,o,n,r,s){const c=o?function(e,t,o){var n;const r=null===(n=t.liveTimeline)||void 0===n?void 0:n.getEvents();if(!r)return;const s=e.getEvent().getRoomId();if(!s)return;const c=o.getRoom(s);if(!c)return;const i=c.getPendingEvents(),a=Boolean(e.getEvent().getThread());return r.concat(a?[]:i)}(o,r,s):function(e,t){var o,n,r;const s=(null===(o=e.eventRelation)||void 0===o?void 0:o.key)===ne.THREAD_RELATION_TYPE.name;return null===(n=t.liveTimeline)||void 0===n?void 0:n.getEvents().concat(s?[]:(null===(r=t.room)||void 0===r?void 0:r.getPendingEvents())||[])}(n,r);if(!c)return!1;const i=(0,X.Iy)({events:c,isForward:t,fromEventId:null==o?void 0:o.getEvent().getId(),matrixClient:s});return!!i&&(ee.A.dispatch({action:te.r.EditEvent,event:i,timelineRenderingType:r.timelineRenderingType}),e.stopPropagation(),e.preventDefault(),!0)}var le=o("./src/components/views/rooms/wysiwyg_composer/hooks/useSetCursorPosition.ts"),me=o("./src/components/views/rooms/wysiwyg_composer/hooks/useIsFocused.ts"),ue=o("./src/utils/permalinks/Permalinks.ts"),de=o("./src/Typeguards.ts");const pe=(0,n.memo)((function({disabled:e=!1,onChange:t,onSend:o,placeholder:c,initialContent:l,className:m,leftComponent:u,rightComponent:d,children:p,eventRelation:f}){const{room:g}=(0,ce.ME)("room"),h=(0,n.useRef)(null),v=ie(o,h,l,f),y=(0,J.ti)("MessageComposerInput.autoReplaceEmoji"),w=(0,n.useMemo)((()=>function(e){const t=new Map(Array.from(r.EMOTICON_TO_EMOJI,(([e,t])=>[e,t.unicode])));return e?t:new Map}(y)),[y]),{ref:b,isWysiwygReady:x,content:_,actionStates:E,wysiwyg:C,suggestion:A,messageContent:k}=(0,s.useWysiwyg)({initialContent:l,inputEventProcessor:v,emojiSuggestions:w}),{isFocused:O,onFocus:j}=(0,me.j)(),N=x&&!e,S=!_&&c||void 0;return(0,le.V)(!N,b),(0,n.useEffect)((()=>{!e&&(0,de.P)(k)&&t(k)}),[t,k,e]),(0,n.useEffect)((()=>{var e;function t(e){if(e.preventDefault(),e.target&&e.target instanceof HTMLAnchorElement&&"user"===e.target.getAttribute("data-mention-type")){const t=(0,ue.$N)(e.target.href);g&&null!=t&&t.userId&&ee.A.dispatch({action:te.r.ViewUser,member:g.getMember(t.userId)})}}const o=null===(e=b.current)||void 0===e?void 0:e.querySelectorAll("a[data-mention-type]");return o&&o.forEach((e=>e.addEventListener("click",t))),()=>{o&&o.forEach((e=>e.removeEventListener("click",t)))}}),[b,g,_]),n.createElement("div",{className:i()(m,{[`${m}-focused`]:O}),onFocus:j,onBlur:j},n.createElement(a.W,{ref:h,suggestion:A,handleMention:C.mention,handleAtRoomMention:C.mentionAtRoom,handleCommand:C.command}),n.createElement($,{composer:C,actionStates:E}),n.createElement(Y.K,{ref:b,disabled:!N,leftComponent:u,rightComponent:d,placeholder:S}),null==p?void 0:p(b,C))}))},"./src/components/views/rooms/wysiwyg_composer/hooks/useIsFocused.ts":(e,t,o)=>{o.d(t,{j:()=>r});var n=o("./node_modules/react/index.js");function r(){const[e,t]=(0,n.useState)(!1),o=(0,n.useRef)();(0,n.useEffect)((()=>()=>clearTimeout(o.current)),[o]);return{isFocused:e,onFocus:(0,n.useCallback)((e=>{clearTimeout(o.current),"focus"===e.type?t(!0):o.current=window.setTimeout((()=>t(!1)),100)}),[t,o])}}},"./src/components/views/rooms/wysiwyg_composer/hooks/useSetCursorPosition.ts":(e,t,o)=>{o.d(t,{V:()=>s});var n=o("./node_modules/react/index.js"),r=o("./src/components/views/rooms/wysiwyg_composer/hooks/utils.ts");function s(e,t){(0,n.useEffect)((()=>{t.current&&!e&&(0,r.bC)(t.current)}),[t,e])}},"./src/components/views/rooms/wysiwyg_composer/hooks/utils.ts":(e,t,o)=>{o.d(t,{Hj:()=>a,VI:()=>u,bC:()=>l,hi:()=>m,wg:()=>d});var n=o("./src/KeyBindingsManager.ts"),r=o("./src/accessibility/KeyboardShortcuts.ts"),s=o("./src/utils/blobs.ts"),c=o("./src/ContentMessages.ts"),i=o("./src/Typeguards.ts");function a(e,t,o,n){var r;t===o.timelineRenderingType&&(null===(r=e.current)||void 0===r||r.focus(),n.current&&clearTimeout(n.current),n.current=window.setTimeout((()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.focus()}),200))}function l(e){const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const o=document.getSelection();o.removeAllRanges(),o.addRange(t),e.focus()}function m(e,t){if(!((null==e?void 0:e.current)&&!e.current.state.hide))return!1;let o=!1;const s=(0,n.zM)().getAutocompleteAction(t),c=e.current;if(c&&c.countCompletions()>0)switch(s){case r.bY.ForceCompleteAutocomplete:case r.bY.CompleteAutocomplete:e.current.onConfirmCompletion(),o=!0;break;case r.bY.PrevSelectionInAutocomplete:e.current.moveSelection(-1),o=!0;break;case r.bY.NextSelectionInAutocomplete:e.current.moveSelection(1),o=!0;break;case r.bY.CancelAutocomplete:e.current.onEscape(t),o=!0}return o&&(t.preventDefault(),t.stopPropagation()),o}function u(e,t,o,n,r){const{room:i,timelineRenderingType:a,replyToEvent:l}=o;function m(e){e instanceof Error?console.log(e.message):"string"==typeof e&&console.log(e)}if("paste"!==e.type||null===t||void 0===i)return!1;if(t.files.length&&!t.types.includes("text/rtf"))return c.Ay.sharedInstance().sendContentListToRoom(Array.from(t.files),i.roomId,r,n,a).catch(m),!0;if(t.types.includes("text/html")){var u;const e=t.getData("text/html"),o=(new DOMParser).parseFromString(e,"text/html");if(1!==o.getElementsByTagName("img").length||null===(u=o.querySelector("img"))||void 0===u||!u.src.startsWith("blob:")||1!==o.childNodes.length)return m("Failed to handle pasted content as Safari inserted content"),!1;const a=o.querySelector("img").src;return fetch(a).then((e=>{e.blob().then((t=>{const o=t.type,a=(0,s.F)(o),u=o.split("/")[1],d=e.url.split("/"),p=d[d.length-1],f=new File([t],p+"."+u,{type:a});c.Ay.sharedInstance().sendContentToRoom(f,i.roomId,r,n,l).catch(m)})).catch(m)})).catch(m),!0}return!1}function d(e){const t=e instanceof InputEvent&&"insertFromPaste"===e.inputType&&(0,i.P)(e.dataTransfer);return e instanceof ClipboardEvent||t}},"./src/components/views/rooms/wysiwyg_composer/utils/editing.ts":(e,t,o)=>{o.d(t,{r:()=>i,w:()=>c});var n=o("./node_modules/matrix-js-sdk/src/matrix.ts"),r=o("./src/dispatcher/dispatcher.ts"),s=o("./src/dispatcher/actions.ts");function c(e){r.A.dispatch({action:s.r.EditEvent,event:null,timelineRenderingType:e.timelineRenderingType}),r.A.dispatch({action:s.r.FocusSendMessageComposer,context:e.timelineRenderingType})}function i(e,t){const o=t.getEvent().replacingEvent();!o||o.status!==n.EventStatus.QUEUED&&o.status!==n.EventStatus.NOT_SENT||e.cancelPendingEvent(o)}},"./src/components/views/rooms/wysiwyg_composer/utils/selection.ts":(e,t,o)=>{function n(e){if(e.anchorNode&&e.focusNode){var t,o;const n=new Range;e.isForward?(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)):(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),null===(t=document.getSelection())||void 0===t||t.removeAllRanges(),null===(o=document.getSelection())||void 0===o||o.addRange(n)}return new Promise((e=>setTimeout(e,0)))}function r(){const e=document.getSelection();return Boolean(null==e?void 0:e.isCollapsed)}function s(e){const t=document.getSelection();if(!t)return!1;if(t.anchorNode===e&&t.anchorOffset<=1)return!0;let o=e.firstChild;do{var n;if(o===t.anchorNode)return 0===t.anchorOffset}while(o=(null===(n=o)||void 0===n?void 0:n.firstChild)||null);return!1}function c(e){var t;const o=document.getSelection();if(!o)return!1;if(o.focusNode===e&&o.focusOffset===(null===(t=e.childNodes)||void 0===t?void 0:t.length))return!0;let n=e.childNodes.item(e.childNodes.length-2);do{var r;if(n===o.focusNode)return o.focusOffset===(null===(r=n.textContent)||void 0===r?void 0:r.length)}while(n=n.lastChild);return!1}o.d(t,{CD:()=>r,tJ:()=>s,td:()=>n,uJ:()=>c})},"./src/components/views/settings/KeyboardShortcut.tsx":(e,t,o)=>{o.d(t,{S:()=>a});var n=o("./node_modules/react/index.js"),r=o("./src/accessibility/KeyboardShortcuts.ts"),s=o("./src/Keyboard.ts"),c=o("./src/languageHandler.tsx");const i=({name:e,last:t})=>{const o=r.GA[e],s=r.hm[e];return n.createElement(n.Fragment,null,n.createElement("kbd",null," ",o||s&&(0,c._t)(s)||e," "),!t&&"+")},a=({value:e,className:t="mx_KeyboardShortcut"})=>{if(!e)return null;const o=[];return e.ctrlOrCmdKey?o.push(n.createElement(i,{key:"ctrlOrCmdKey",name:s.vL?s.Uz.META:s.Uz.CONTROL})):e.ctrlKey?o.push(n.createElement(i,{key:"ctrlKey",name:s.Uz.CONTROL})):e.metaKey&&o.push(n.createElement(i,{key:"metaKey",name:s.Uz.META})),e.altKey&&o.push(n.createElement(i,{key:"altKey",name:s.Uz.ALT})),e.shiftKey&&o.push(n.createElement(i,{key:"shiftKey",name:s.Uz.SHIFT})),n.createElement("div",{className:t},o,n.createElement(i,{name:e.key,last:!0}))}}}]);
//# sourceMappingURL=1526.js.map