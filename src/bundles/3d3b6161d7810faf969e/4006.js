"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[395,4006,8227],{"./src/components/views/location/LocationViewDialog.tsx":(e,o,t)=>{t.r(o),t.d(o,{default:()=>d});var n=t("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=t("./node_modules/react/index.js"),s=t("./src/components/views/dialogs/BaseDialog.tsx"),a=t("./src/utils/location/index.ts"),i=t("./src/components/views/location/Map.tsx"),l=t("./src/components/views/location/SmartMarker.tsx"),c=t("./src/components/views/location/ZoomButtons.tsx");class d extends r.Component{constructor(e){super(e),(0,n.A)(this,"getBodyId",(()=>`mx_LocationViewDialog_${this.props.mxEvent.getId()}`)),(0,n.A)(this,"onError",(e=>{this.setState({error:e})})),this.state={error:void 0}}render(){const{mxEvent:e}=this.props,o=(0,a.qy)(e.getContent())&&e.sender||void 0,t=(0,a.jm)(e);return r.createElement(s.A,{className:"mx_LocationViewDialog",onFinished:this.props.onFinished,fixedWidth:!1},r.createElement(i.default,{id:this.getBodyId(),centerGeoUri:t,onError:this.onError,interactive:!0,className:"mx_LocationViewDialog_map",allowGeolocate:!0},(({map:e})=>r.createElement(r.Fragment,null,r.createElement(l.default,{map:e,id:`${this.getBodyId()}-marker`,geoUri:t,roomMember:o}),r.createElement(c.A,{map:e})))))}}},"./src/components/views/location/Map.tsx":(e,o,t)=>{t.r(o),t.d(o,{default:()=>h});var n=t("./node_modules/react/index.js"),r=t("./node_modules/classnames/index.js"),s=t.n(r),a=t("./node_modules/maplibre-gl/dist/maplibre-gl.js"),i=t("./node_modules/matrix-js-sdk/src/matrix.ts"),l=t("./node_modules/matrix-js-sdk/src/logger.ts"),c=t("./src/contexts/MatrixClientContext.tsx"),d=t("./src/hooks/useEventEmitter.ts"),m=t("./src/utils/location/index.ts"),u=t("./src/utils/WellKnownUtils.ts"),p=t("./src/utils/location/map.ts");var _=t("./src/Modal.tsx"),v=t("./src/components/views/dialogs/ErrorDialog.tsx"),g=t("./src/languageHandler.tsx");const x=({id:e,centerGeoUri:o,onError:t,interactive:r,bounds:s,allowGeolocate:_})=>{const v=`mx_Map_${e}`,g=(0,n.useContext)(c.Ay),x=(0,d.dF)(g,i.ClientEvent.ClientWellKnown,(e=>{var o;return null===(o=(0,u.XP)(e))||void 0===o?void 0:o.map_style_url})),h=(({interactive:e,bodyId:o,onError:t})=>{const r=(0,c.nH)(),[s,a]=(0,n.useState)();return(0,n.useEffect)((()=>{try{a((0,p.p)(r,!!e,o,t))}catch(e){console.error("Error encountered in useMap",e),e instanceof Error&&(null==t||t(e))}return()=>{s&&(s.remove(),a(void 0))}}),[e,o,t]),s})({interactive:r,bodyId:v,onError:t});(0,n.useEffect)((()=>{x&&h&&h.setStyle(x)}),[x,h]),(0,n.useEffect)((()=>{if(h&&o)try{const e=(0,m.XB)(o);if(!e)throw new Error("Invalid geo URI");h.setCenter({lon:e.longitude,lat:e.latitude})}catch(e){l.v.error("Could not set map center",e)}}),[h,o]),(0,n.useEffect)((()=>{if(h&&s)try{const e=new a.LngLatBounds([s.west,s.south],[s.east,s.north]);h.fitBounds(e,{padding:100,maxZoom:15})}catch(e){l.v.error("Invalid map bounds",e)}}),[h,s]);const[w,b]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(h){if(_&&!w){const e=new a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1});b(e),h.addControl(e)}!_&&w&&(h.removeControl(w),b(null))}}),[h,w,_]),(0,n.useEffect)((()=>{if(w)return w.on("error",f),()=>{w.off("error",f)}}),[w]),{map:h,bodyId:v}},f=e=>{var o;l.v.error("Could not fetch location",e),_.Ay.createDialog(v.A,{title:(0,g._t)("location_sharing|error_fetch_location"),description:null!==(o=(0,m.Ff)(e.code))&&void 0!==o?o:""})},h=({bounds:e,centerGeoUri:o,children:t,className:r,allowGeolocate:a,id:i,interactive:l,onError:c,onClick:d})=>{const{map:m,bodyId:u}=x({centerGeoUri:o,onError:c,id:i,interactive:l,bounds:e,allowGeolocate:a});return n.createElement("div",{className:s()("mx_Map",r),id:u,onClick:e=>{e.target.classList.contains("maplibregl-ctrl-attrib-button")||null==d||d()}},!!t&&!!m&&t({map:m}))}},"./src/components/views/location/Marker.tsx":(e,o,t)=>{t.d(o,{A:()=>d});var n=t("./node_modules/react/index.js"),r=t("./node_modules/classnames/index.js"),s=t.n(r),a=t("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/location-pin-solid.js"),i=t("./src/utils/FormattingUtils.ts"),l=t("./src/components/views/avatars/MemberAvatar.tsx");const c=({tooltip:e,children:o})=>{const[t,r]=(0,n.useState)(!1);if(!e)return n.createElement(n.Fragment,null,o);return n.createElement("div",{onMouseEnter:()=>r(!0),onClick:e=>{e.stopPropagation(),r(!t)},onMouseLeave:()=>r(!1)},o,t&&e)},d=n.forwardRef((({id:e,roomMember:o,useMemberColor:t,tooltip:r},d)=>{const m=t&&o?(0,i.yJ)(o.userId):"";return n.createElement("div",{ref:d,id:e,className:s()("mx_Marker",m,{mx_Marker_defaultColor:!m})},n.createElement(c,{tooltip:r},n.createElement("div",{className:"mx_Marker_border"},o?n.createElement(l.A,{member:o,size:"36px",viewUserOnClick:!1,hideTitle:!!r}):n.createElement(a.A,{className:"mx_Marker_icon"}))))}))},"./src/components/views/location/SmartMarker.tsx":(e,o,t)=>{t.r(o),t.d(o,{default:()=>i});var n=t("./node_modules/react/index.js"),r=t("./src/utils/location/index.ts"),s=t("./src/utils/location/map.ts"),a=t("./src/components/views/location/Marker.tsx");const i=({id:e,map:o,geoUri:t,roomMember:i,useMemberColor:l,tooltip:c})=>{const{onElementRef:d}=((e,o)=>{const[t,a]=(0,n.useState)(),i=(0,n.useCallback)((n=>{if(t||!n)return;const i=(0,r.XB)(o);if(i){const o=(0,s.h)(i,n);o.addTo(e),a(o)}}),[t,o,e]);return(0,n.useEffect)((()=>{if(t){const e=(0,r.XB)(o);e&&t.setLngLat({lon:e.longitude,lat:e.latitude})}}),[t,o]),(0,n.useEffect)((()=>()=>{t&&t.remove()}),[t]),{marker:t,onElementRef:i}})(o,t);return n.createElement("span",null,n.createElement(a.A,{ref:d,id:e,roomMember:i,useMemberColor:l,tooltip:c}))}},"./src/components/views/location/ZoomButtons.tsx":(e,o,t)=>{t.d(o,{A:()=>l});var n=t("./node_modules/react/index.js"),r=t("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/plus.js"),s=t("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/minus.js"),a=t("./src/languageHandler.tsx"),i=t("./src/components/views/elements/AccessibleButton.tsx");const l=({map:e})=>n.createElement("div",{className:"mx_ZoomButtons"},n.createElement(i.A,{onClick:()=>{e.zoomIn()},title:(0,a._t)("action|zoom_in"),className:"mx_ZoomButtons_button"},n.createElement(r.A,{className:"mx_ZoomButtons_icon"})),n.createElement(i.A,{onClick:()=>{e.zoomOut()},title:(0,a._t)("action|zoom_out"),className:"mx_ZoomButtons_button"},n.createElement(s.A,{className:"mx_ZoomButtons_icon"})))},"./src/utils/location/map.ts":(e,o,t)=>{t.d(o,{h:()=>c,p:()=>l});var n=t("./node_modules/maplibre-gl/dist/maplibre-gl.js"),r=t("./node_modules/matrix-js-sdk/src/logger.ts"),s=t("./src/languageHandler.tsx"),a=t("./src/utils/location/findMapStyleUrl.ts"),i=t("./src/utils/location/LocationShareErrors.ts");const l=(e,o,t,l)=>{try{const c=(0,a.M)(e),d=new n.Map({container:t,style:c,zoom:15,interactive:o,attributionControl:!1,locale:{"AttributionControl.ToggleAttribution":(0,s._t)("location_sharing|toggle_attribution"),"AttributionControl.MapFeedback":(0,s._t)("location_sharing|map_feedback"),"FullscreenControl.Enter":(0,s._t)("action|enter_fullscreen"),"FullscreenControl.Exit":(0,s._t)("action|exit_fullscreeen"),"GeolocateControl.FindMyLocation":(0,s._t)("location_sharing|find_my_location"),"GeolocateControl.LocationNotAvailable":(0,s._t)("location_sharing|location_not_available"),"LogoControl.Title":(0,s._t)("location_sharing|mapbox_logo"),"NavigationControl.ResetBearing":(0,s._t)("location_sharing|reset_bearing"),"NavigationControl.ZoomIn":(0,s._t)("action|zoom_in"),"NavigationControl.ZoomOut":(0,s._t)("action|zoom_out")}});return d.addControl(new n.AttributionControl,"top-right"),d.on("error",(e=>{r.v.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),null==l||l(new Error(i.$.MapStyleUrlNotReachable))})),d}catch(e){r.v.error("Failed to render map",e);if((null==e?void 0:e.message).includes("Failed to initialize WebGL"))throw new Error(i.$.WebGLNotEnabled);throw e}},c=(e,o)=>new n.Marker({element:o,anchor:"bottom",offset:[0,-1]}).setLngLat({lon:e.longitude,lat:e.latitude})},"./node_modules/@vector-im/compound-design-tokens/assets/web/icons/minus.js":(e,o,t)=>{t.d(o,{A:()=>a});var n=t("./node_modules/react/index.js"),r=t("./node_modules/react/jsx-runtime.js");function s(e,o){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:o,...e,children:(0,r.jsx)("path",{d:"M6 13a.967.967 0 0 1-.713-.287A.968.968 0 0 1 5 12c0-.283.096-.52.287-.713A.967.967 0 0 1 6 11h12a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 18 13H6Z"})})}s.displayName="MinusIcon";const a=(0,n.forwardRef)(s)},"./node_modules/@vector-im/compound-design-tokens/assets/web/icons/plus.js":(e,o,t)=>{t.d(o,{A:()=>a});var n=t("./node_modules/react/index.js"),r=t("./node_modules/react/jsx-runtime.js");function s(e,o){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:o,...e,children:(0,r.jsx)("path",{d:"M11 13H6a.967.967 0 0 1-.713-.287A.968.968 0 0 1 5 12c0-.283.096-.52.287-.713A.967.967 0 0 1 6 11h5V6c0-.283.096-.52.287-.713A.968.968 0 0 1 12 5c.283 0 .52.096.713.287.191.192.287.43.287.713v5h5a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 18 13h-5v5a.97.97 0 0 1-.287.712A.968.968 0 0 1 12 19a.968.968 0 0 1-.713-.288A.968.968 0 0 1 11 18v-5Z"})})}s.displayName="PlusIcon";const a=(0,n.forwardRef)(s)}}]);
//# sourceMappingURL=4006.js.map