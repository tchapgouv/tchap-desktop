{"version":3,"file":"bundles/3d3b6161d7810faf969e/1188.js","mappings":"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","sources":["webpack://element-web/./src/components/views/rooms/CollapsibleButton.tsx","webpack://element-web/./src/components/views/rooms/EmojiButton.tsx","webpack://element-web/./src/components/views/rooms/MessageComposerButtons.tsx","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/hooks/useSuggestion.ts","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/hooks/usePlainTextListeners.ts","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/components/PlainTextComposer.tsx","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/hooks/useComposerFunctions.ts","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/hooks/usePlainTextInitialization.ts","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/components/Emoji.tsx","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/SendWysiwygComposer.tsx","webpack://element-web/./src/components/views/rooms/wysiwyg_composer/hooks/useWysiwygSendActionHandler.ts"],"sourcesContent":["/*\nCopyright 2024 New Vector Ltd.\nCopyright 2021 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport React, { useContext } from \"react\";\nimport classNames from \"classnames\";\n\nimport AccessibleButton, { ButtonProps } from \"../elements/AccessibleButton\";\nimport { OverflowMenuContext } from \"./MessageComposerButtons\";\nimport { IconizedContextMenuOption } from \"../context_menus/IconizedContextMenu\";\nimport { Ref } from \"../../../accessibility/roving/types\";\n\ninterface Props extends Omit<ButtonProps<\"div\">, \"element\"> {\n    inputRef?: Ref;\n    title: string;\n    iconClassName: string;\n}\n\nexport const CollapsibleButton: React.FC<Props> = ({\n    title,\n    children,\n    className,\n    iconClassName,\n    inputRef,\n    ...props\n}) => {\n    const inOverflowMenu = !!useContext(OverflowMenuContext);\n    if (inOverflowMenu) {\n        return <IconizedContextMenuOption {...props} iconClassName={iconClassName} label={title} inputRef={inputRef} />;\n    }\n\n    return (\n        <AccessibleButton {...props} title={title} className={classNames(className, iconClassName)} ref={inputRef}>\n            {children}\n        </AccessibleButton>\n    );\n};\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport classNames from \"classnames\";\nimport React, { useContext } from \"react\";\n\nimport { _t } from \"../../../languageHandler\";\nimport ContextMenu, { aboveLeftOf, MenuProps, useContextMenu } from \"../../structures/ContextMenu\";\nimport EmojiPicker from \"../emojipicker/EmojiPicker\";\nimport { CollapsibleButton } from \"./CollapsibleButton\";\nimport { OverflowMenuContext } from \"./MessageComposerButtons\";\n\ninterface IEmojiButtonProps {\n    addEmoji: (unicode: string) => boolean;\n    menuPosition?: MenuProps;\n    className?: string;\n}\n\nexport function EmojiButton({ addEmoji, menuPosition, className }: IEmojiButtonProps): JSX.Element {\n    const overflowMenuCloser = useContext(OverflowMenuContext);\n    const [menuDisplayed, button, openMenu, closeMenu] = useContextMenu();\n\n    let contextMenu: React.ReactElement | null = null;\n    if (menuDisplayed && button.current) {\n        const position = menuPosition ?? aboveLeftOf(button.current.getBoundingClientRect());\n        const onFinished = (): void => {\n            closeMenu();\n            overflowMenuCloser?.();\n        };\n\n        contextMenu = (\n            <ContextMenu {...position} onFinished={onFinished} managed={false}>\n                <EmojiPicker onChoose={addEmoji} onFinished={onFinished} />\n            </ContextMenu>\n        );\n    }\n\n    const computedClassName = classNames(\"mx_EmojiButton\", className, {\n        mx_EmojiButton_highlight: menuDisplayed,\n    });\n\n    // TODO: replace ContextMenuTooltipButton with a unified representation of\n    // the header buttons and the right panel buttons\n    return (\n        <>\n            <CollapsibleButton\n                className={computedClassName}\n                iconClassName=\"mx_EmojiButton_icon\"\n                onClick={openMenu}\n                title={_t(\"common|emoji\")}\n                inputRef={button}\n            />\n\n            {contextMenu}\n        </>\n    );\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport classNames from \"classnames\";\nimport { IEventRelation, Room, MatrixClient, THREAD_RELATION_TYPE, M_POLL_START } from \"matrix-js-sdk/src/matrix\";\nimport React, { createContext, ReactElement, ReactNode, useContext, useRef } from \"react\";\n\nimport { _t } from \"../../../languageHandler\";\nimport { CollapsibleButton } from \"./CollapsibleButton\";\nimport { MenuProps } from \"../../structures/ContextMenu\";\nimport dis from \"../../../dispatcher/dispatcher\";\nimport ErrorDialog from \"../dialogs/ErrorDialog\";\nimport { LocationButton } from \"../location\";\nimport Modal from \"../../../Modal\";\nimport PollCreateDialog from \"../elements/PollCreateDialog\";\nimport { MatrixClientPeg } from \"../../../MatrixClientPeg\";\nimport ContentMessages from \"../../../ContentMessages\";\nimport MatrixClientContext from \"../../../contexts/MatrixClientContext\";\nimport { useDispatcher } from \"../../../hooks/useDispatcher\";\nimport { chromeFileInputFix } from \"../../../utils/BrowserWorkarounds\";\nimport IconizedContextMenu, { IconizedContextMenuOptionList } from \"../context_menus/IconizedContextMenu\";\nimport { EmojiButton } from \"./EmojiButton\";\nimport { filterBoolean } from \"../../../utils/arrays\";\nimport { useSettingValue } from \"../../../hooks/useSettings\";\nimport AccessibleButton, { ButtonEvent } from \"../elements/AccessibleButton\";\nimport { useScopedRoomContext } from \"../../../contexts/ScopedRoomContext.tsx\";\n\ninterface IProps {\n    addEmoji: (emoji: string) => boolean;\n    haveRecording: boolean;\n    isMenuOpen: boolean;\n    isStickerPickerOpen: boolean;\n    menuPosition?: MenuProps;\n    onRecordStartEndClick: () => void;\n    relation?: IEventRelation;\n    setStickerPickerOpen: (isStickerPickerOpen: boolean) => void;\n    showLocationButton: boolean;\n    showPollsButton: boolean;\n    showStickersButton: boolean;\n    toggleButtonMenu: () => void;\n    isRichTextEnabled: boolean;\n    onComposerModeClick: () => void;\n}\n\ntype OverflowMenuCloser = () => void;\nexport const OverflowMenuContext = createContext<OverflowMenuCloser | null>(null);\n\nconst MessageComposerButtons: React.FC<IProps> = (props: IProps) => {\n    const matrixClient = useContext(MatrixClientContext);\n    const { room, narrow } = useScopedRoomContext(\"room\", \"narrow\");\n\n    const isWysiwygLabEnabled = useSettingValue<boolean>(\"feature_wysiwyg_composer\");\n\n    if (!matrixClient || !room || props.haveRecording) {\n        return null;\n    }\n\n    let mainButtons: ReactNode[];\n    let moreButtons: ReactNode[];\n    if (narrow) {\n        mainButtons = [\n            isWysiwygLabEnabled ? (\n                <ComposerModeButton\n                    key=\"composerModeButton\"\n                    isRichTextEnabled={props.isRichTextEnabled}\n                    onClick={props.onComposerModeClick}\n                />\n            ) : (\n                emojiButton(props)\n            ),\n        ];\n        moreButtons = [\n            uploadButton(), // props passed via UploadButtonContext\n            showStickersButton(props),\n            voiceRecordingButton(props, narrow),\n            props.showPollsButton ? pollButton(room, props.relation) : null,\n            showLocationButton(props, room, matrixClient),\n        ];\n    } else {\n        mainButtons = [\n            isWysiwygLabEnabled ? (\n                <ComposerModeButton\n                    key=\"composerModeButton\"\n                    isRichTextEnabled={props.isRichTextEnabled}\n                    onClick={props.onComposerModeClick}\n                />\n            ) : (\n                emojiButton(props)\n            ),\n            uploadButton(), // props passed via UploadButtonContext\n        ];\n        moreButtons = [\n            showStickersButton(props),\n            voiceRecordingButton(props, narrow),\n            props.showPollsButton ? pollButton(room, props.relation) : null,\n            showLocationButton(props, room, matrixClient),\n        ];\n    }\n\n    mainButtons = filterBoolean(mainButtons);\n    moreButtons = filterBoolean(moreButtons);\n\n    const moreOptionsClasses = classNames({\n        mx_MessageComposer_button: true,\n        mx_MessageComposer_buttonMenu: true,\n        mx_MessageComposer_closeButtonMenu: props.isMenuOpen,\n    });\n\n    return (\n        <UploadButtonContextProvider roomId={room.roomId} relation={props.relation}>\n            {mainButtons}\n            {moreButtons.length > 0 && (\n                <AccessibleButton\n                    className={moreOptionsClasses}\n                    onClick={props.toggleButtonMenu}\n                    title={_t(\"quick_settings|sidebar_settings\")}\n                />\n            )}\n            {props.isMenuOpen && (\n                <IconizedContextMenu\n                    onFinished={props.toggleButtonMenu}\n                    {...props.menuPosition}\n                    wrapperClassName=\"mx_MessageComposer_Menu\"\n                    compact={true}\n                >\n                    <OverflowMenuContext.Provider value={props.toggleButtonMenu}>\n                        <IconizedContextMenuOptionList>{moreButtons}</IconizedContextMenuOptionList>\n                    </OverflowMenuContext.Provider>\n                </IconizedContextMenu>\n            )}\n        </UploadButtonContextProvider>\n    );\n};\n\nfunction emojiButton(props: IProps): ReactElement {\n    return (\n        <EmojiButton\n            key=\"emoji_button\"\n            addEmoji={props.addEmoji}\n            menuPosition={props.menuPosition}\n            className=\"mx_MessageComposer_button\"\n        />\n    );\n}\n\nfunction uploadButton(): ReactElement {\n    return <UploadButton key=\"controls_upload\" />;\n}\n\ntype UploadButtonFn = () => void;\nexport const UploadButtonContext = createContext<UploadButtonFn | null>(null);\n\ninterface IUploadButtonProps {\n    roomId: string;\n    relation?: IEventRelation;\n    children: ReactNode;\n}\n\n// We put the file input outside the UploadButton component so that it doesn't get killed when the context menu closes.\nconst UploadButtonContextProvider: React.FC<IUploadButtonProps> = ({ roomId, relation, children }) => {\n    const cli = useContext(MatrixClientContext);\n    const roomContext = useScopedRoomContext(\"timelineRenderingType\");\n    const uploadInput = useRef<HTMLInputElement>(null);\n\n    const onUploadClick = (): void => {\n        if (cli?.isGuest()) {\n            dis.dispatch({ action: \"require_registration\" });\n            return;\n        }\n        uploadInput.current?.click();\n    };\n\n    useDispatcher(dis, (payload) => {\n        if (roomContext.timelineRenderingType === payload.context && payload.action === \"upload_file\") {\n            onUploadClick();\n        }\n    });\n\n    const onUploadFileInputChange = (ev: React.ChangeEvent<HTMLInputElement>): void => {\n        if (ev.target.files?.length === 0) return;\n\n        // Take a copy, so we can safely reset the value of the form control\n        ContentMessages.sharedInstance().sendContentListToRoom(\n            Array.from(ev.target.files!),\n            roomId,\n            relation,\n            cli,\n            roomContext.timelineRenderingType,\n        );\n\n        // This is the onChange handler for a file form control, but we're\n        // not keeping any state, so reset the value of the form control\n        // to empty.\n        // NB. we need to set 'value': the 'files' property is immutable.\n        ev.target.value = \"\";\n    };\n\n    const uploadInputStyle = { display: \"none\" };\n    return (\n        <UploadButtonContext.Provider value={onUploadClick}>\n            {children}\n\n            <input\n                ref={uploadInput}\n                type=\"file\"\n                style={uploadInputStyle}\n                multiple\n                onClick={chromeFileInputFix}\n                onChange={onUploadFileInputChange}\n            />\n        </UploadButtonContext.Provider>\n    );\n};\n\n// Must be rendered within an UploadButtonContextProvider\nconst UploadButton: React.FC = () => {\n    const overflowMenuCloser = useContext(OverflowMenuContext);\n    const uploadButtonFn = useContext(UploadButtonContext);\n\n    const onClick = (): void => {\n        uploadButtonFn?.();\n        overflowMenuCloser?.(); // close overflow menu\n    };\n\n    return (\n        <CollapsibleButton\n            className=\"mx_MessageComposer_button\"\n            iconClassName=\"mx_MessageComposer_upload\"\n            onClick={onClick}\n            title={_t(\"common|attachment\")}\n        />\n    );\n};\n\nfunction showStickersButton(props: IProps): ReactElement | null {\n    return props.showStickersButton ? (\n        <CollapsibleButton\n            id=\"stickersButton\"\n            key=\"controls_stickers\"\n            className=\"mx_MessageComposer_button\"\n            iconClassName=\"mx_MessageComposer_stickers\"\n            onClick={() => props.setStickerPickerOpen(!props.isStickerPickerOpen)}\n            title={props.isStickerPickerOpen ? _t(\"composer|close_sticker_picker\") : _t(\"common|sticker\")}\n        />\n    ) : null;\n}\n\nfunction voiceRecordingButton(props: IProps, narrow: boolean): ReactElement | null {\n    // XXX: recording UI does not work well in narrow mode, so hide for now\n    return narrow ? null : (\n        <CollapsibleButton\n            key=\"voice_message_send\"\n            className=\"mx_MessageComposer_button\"\n            iconClassName=\"mx_MessageComposer_voiceMessage\"\n            onClick={props.onRecordStartEndClick}\n            title={_t(\"composer|voice_message_button\")}\n        />\n    );\n}\n\nfunction pollButton(room: Room, relation?: IEventRelation): ReactElement {\n    return <PollButton key=\"polls\" room={room} relation={relation} />;\n}\n\ninterface IPollButtonProps {\n    room: Room;\n    relation?: IEventRelation;\n}\n\nclass PollButton extends React.PureComponent<IPollButtonProps> {\n    public static contextType = OverflowMenuContext;\n    declare public context: React.ContextType<typeof OverflowMenuContext>;\n\n    private onCreateClick = (): void => {\n        this.context?.(); // close overflow menu\n        const canSend = this.props.room.currentState.maySendEvent(\n            M_POLL_START.name,\n            MatrixClientPeg.safeGet().getSafeUserId(),\n        );\n        if (!canSend) {\n            Modal.createDialog(ErrorDialog, {\n                title: _t(\"composer|poll_button_no_perms_title\"),\n                description: _t(\"composer|poll_button_no_perms_description\"),\n            });\n        } else {\n            const threadId =\n                this.props.relation?.rel_type === THREAD_RELATION_TYPE.name ? this.props.relation.event_id : undefined;\n\n            Modal.createDialog(\n                PollCreateDialog,\n                {\n                    room: this.props.room,\n                    threadId,\n                },\n                \"mx_CompoundDialog\",\n                false, // isPriorityModal\n                true, // isStaticModal\n            );\n        }\n    };\n\n    public render(): React.ReactNode {\n        // do not allow sending polls within threads at this time\n        if (this.props.relation?.rel_type === THREAD_RELATION_TYPE.name) return null;\n\n        return (\n            <CollapsibleButton\n                className=\"mx_MessageComposer_button\"\n                iconClassName=\"mx_MessageComposer_poll\"\n                onClick={this.onCreateClick}\n                title={_t(\"composer|poll_button\")}\n            />\n        );\n    }\n}\n\nfunction showLocationButton(props: IProps, room: Room, matrixClient: MatrixClient): ReactElement | null {\n    const sender = room.getMember(matrixClient.getSafeUserId());\n\n    return props.showLocationButton && sender ? (\n        <LocationButton\n            key=\"location\"\n            roomId={room.roomId}\n            relation={props.relation}\n            sender={sender}\n            menuPosition={props.menuPosition}\n        />\n    ) : null;\n}\n\ninterface WysiwygToggleButtonProps {\n    isRichTextEnabled: boolean;\n    onClick: (ev: ButtonEvent) => void;\n}\n\nfunction ComposerModeButton({ isRichTextEnabled, onClick }: WysiwygToggleButtonProps): JSX.Element {\n    const title = isRichTextEnabled ? _t(\"composer|mode_plain\") : _t(\"composer|mode_rich_text\");\n\n    return (\n        <CollapsibleButton\n            className=\"mx_MessageComposer_button\"\n            iconClassName={classNames({\n                mx_MessageComposer_plain_text: !isRichTextEnabled,\n                mx_MessageComposer_rich_text: isRichTextEnabled,\n            })}\n            onClick={onClick}\n            title={title}\n        />\n    );\n}\n\nexport default MessageComposerButtons;\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2023 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport { EMOTICON_TO_EMOJI } from \"@matrix-org/emojibase-bindings\";\nimport { AllowedMentionAttributes, MappedSuggestion } from \"@vector-im/matrix-wysiwyg\";\nimport { SyntheticEvent, useState, SetStateAction } from \"react\";\nimport { logger } from \"matrix-js-sdk/src/logger\";\n\nimport { isNotNull } from \"../../../../../Typeguards\";\n\n/**\n * Information about the current state of the `useSuggestion` hook.\n */\nexport type Suggestion = {\n    mappedSuggestion: MappedSuggestion;\n    /* The information in a `MappedSuggestion` is sufficient to generate a query for the autocomplete\n    component but more information is required to allow manipulation of the correct part of the DOM\n    when selecting an option from the autocomplete. These three pieces of information allow us to\n    do that.\n    */\n    node: Node;\n    startOffset: number;\n    endOffset: number;\n};\ntype SuggestionState = Suggestion | null;\n\n/**\n * React hook to allow tracking and replacing of mentions and commands in a div element\n *\n * @param editorRef - a ref to the div that is the composer textbox\n * @param setText - setter function to set the content of the composer\n * @param isAutoReplaceEmojiEnabled - whether plain text emoticons should be auto replaced with emojis\n * @returns\n * - `handleMention`: a function that will insert @ or # mentions which are selected from\n * the autocomplete into the composer, given an href, the text to display, and any additional attributes\n * - `handleCommand`: a function that will replace the content of the composer with the given replacement text.\n * Can be used to process autocomplete of slash commands\n * - `onSelect`: a selection change listener to be attached to the plain text composer\n * - `suggestion`: if the cursor is inside something that could be interpreted as a command or a mention,\n * this will be an object representing that command or mention, otherwise it is null\n */\nexport function useSuggestion(\n    editorRef: React.RefObject<HTMLDivElement>,\n    setText: (text?: string) => void,\n    isAutoReplaceEmojiEnabled?: boolean,\n): {\n    handleMention: (href: string, displayName: string, attributes: AllowedMentionAttributes) => void;\n    handleAtRoomMention: (attributes: AllowedMentionAttributes) => void;\n    handleCommand: (text: string) => void;\n    handleEmojiReplacement: () => void;\n    onSelect: (event: SyntheticEvent<HTMLDivElement>) => void;\n    suggestion: MappedSuggestion | null;\n} {\n    const [suggestionData, setSuggestionData0] = useState<SuggestionState>(null);\n\n    // debug for https://github.com/vector-im/element-web/issues/26037\n    const setSuggestionData = (suggestionData: SetStateAction<SuggestionState>): void => {\n        // setState allows either the data itself or a callback which returns the data\n        logger.log(\n            `## 26037 ## wysiwyg useSuggestion hook setting suggestion data to ${\n                suggestionData === null || suggestionData instanceof Function\n                    ? suggestionData\n                    : suggestionData.mappedSuggestion.keyChar + suggestionData.mappedSuggestion.text\n            }`,\n        );\n        setSuggestionData0(suggestionData);\n    };\n\n    // We create a `selectionchange` handler here because we need to know when the user has moved the cursor,\n    // we can not depend on input events only\n    const onSelect = (): void => processSelectionChange(editorRef, setSuggestionData, isAutoReplaceEmojiEnabled);\n\n    const handleMention = (href: string, displayName: string, attributes: AllowedMentionAttributes): void =>\n        processMention(href, displayName, attributes, suggestionData, setSuggestionData, setText);\n\n    const handleAtRoomMention = (attributes: AllowedMentionAttributes): void =>\n        processMention(\"#\", \"@room\", attributes, suggestionData, setSuggestionData, setText);\n\n    const handleCommand = (replacementText: string): void =>\n        processCommand(replacementText, suggestionData, setSuggestionData, setText);\n\n    const handleEmojiReplacement = (): void => processEmojiReplacement(suggestionData, setSuggestionData, setText);\n\n    return {\n        suggestion: suggestionData?.mappedSuggestion ?? null,\n        handleCommand,\n        handleMention,\n        handleAtRoomMention,\n        handleEmojiReplacement,\n        onSelect,\n    };\n}\n\n/**\n * When the selection changes inside the current editor, check to see if the cursor is inside\n * something that could be a command or a mention and update the suggestion state if so\n *\n * @param editorRef - ref to the composer\n * @param setSuggestionData - the setter for the suggestion state\n * @param isAutoReplaceEmojiEnabled - whether plain text emoticons should be auto replaced with emojis\n */\nexport function processSelectionChange(\n    editorRef: React.RefObject<HTMLDivElement>,\n    setSuggestionData: React.Dispatch<React.SetStateAction<SuggestionState>>,\n    isAutoReplaceEmojiEnabled?: boolean,\n): void {\n    const selection = document.getSelection();\n\n    // return early if we do not have a current editor ref with a cursor selection inside a text node\n    if (\n        editorRef.current === null ||\n        selection === null ||\n        !selection.isCollapsed ||\n        selection.anchorNode?.nodeName !== \"#text\"\n    ) {\n        setSuggestionData(null);\n        return;\n    }\n\n    // from here onwards we have a cursor inside a text node\n    const { anchorNode: currentNode, anchorOffset: currentOffset } = selection;\n\n    // if we have no text content, return, clearing the suggestion state\n    if (currentNode.textContent === null) {\n        setSuggestionData(null);\n        return;\n    }\n\n    const firstTextNode = document.createNodeIterator(editorRef.current, NodeFilter.SHOW_TEXT).nextNode();\n    const isFirstTextNode = currentNode === firstTextNode;\n    const foundSuggestion = findSuggestionInText(\n        currentNode.textContent,\n        currentOffset,\n        isFirstTextNode,\n        isAutoReplaceEmojiEnabled,\n    );\n\n    // if we have not found a suggestion, return, clearing the suggestion state\n    if (foundSuggestion === null) {\n        setSuggestionData(null);\n        return;\n    }\n\n    setSuggestionData({\n        mappedSuggestion: foundSuggestion.mappedSuggestion,\n        node: currentNode,\n        startOffset: foundSuggestion.startOffset,\n        endOffset: foundSuggestion.endOffset,\n    });\n}\n\n/**\n * Replaces the relevant part of the editor text with a link representing a mention after it\n * is selected from the autocomplete.\n *\n * @param href - the href that the inserted link will use\n * @param displayName - the text content of the link\n * @param attributes - additional attributes to add to the link, can include data-* attributes\n * @param suggestionData - representation of the part of the DOM that will be replaced\n * @param setSuggestionData - setter function to set the suggestion state\n * @param setText - setter function to set the content of the composer\n */\nexport function processMention(\n    href: string,\n    displayName: string,\n    attributes: AllowedMentionAttributes, // these will be used when formatting the link as a pill\n    suggestionData: SuggestionState,\n    setSuggestionData: React.Dispatch<React.SetStateAction<SuggestionState>>,\n    setText: (text?: string) => void,\n): void {\n    // if we do not have a suggestion, return early\n    if (suggestionData === null) {\n        return;\n    }\n\n    const { node } = suggestionData;\n\n    // create an <a> element with the required attributes to allow us to interpret the mention as being a pill\n    const linkElement = document.createElement(\"a\");\n    const linkTextNode = document.createTextNode(displayName);\n    linkElement.setAttribute(\"href\", href);\n    linkElement.setAttribute(\"contenteditable\", \"false\");\n\n    for (const [attr, value] of attributes.entries()) {\n        linkElement.setAttribute(attr, value);\n    }\n\n    linkElement.appendChild(linkTextNode);\n\n    // create text nodes to go before and after the link\n    const leadingTextNode = document.createTextNode(node.textContent?.slice(0, suggestionData.startOffset) || \"\\u200b\");\n    const trailingTextNode = document.createTextNode(` ${node.textContent?.slice(suggestionData.endOffset) ?? \"\"}`);\n\n    // now add the leading text node, link element and trailing text node before removing the node we are replacing\n    const parentNode = node.parentNode;\n    if (isNotNull(parentNode)) {\n        parentNode.insertBefore(leadingTextNode, node);\n        parentNode.insertBefore(linkElement, node);\n        parentNode.insertBefore(trailingTextNode, node);\n        parentNode.removeChild(node);\n    }\n\n    // move the selection to the trailing text node\n    document.getSelection()?.setBaseAndExtent(trailingTextNode, 1, trailingTextNode, 1);\n\n    // set the text content to be the innerHTML of the current editor ref and clear the suggestion state\n    setText();\n    setSuggestionData(null);\n}\n\n/**\n * Replaces the relevant part of the editor text with the replacement text after a command is selected\n * from the autocomplete.\n *\n * @param replacementText - the text that we will insert into the DOM\n * @param suggestionData - representation of the part of the DOM that will be replaced\n * @param setSuggestionData - setter function to set the suggestion state\n * @param setText - setter function to set the content of the composer\n */\nexport function processCommand(\n    replacementText: string,\n    suggestionData: SuggestionState,\n    setSuggestionData: React.Dispatch<React.SetStateAction<SuggestionState>>,\n    setText: (text?: string) => void,\n): void {\n    // if we do not have a suggestion, return early\n    if (suggestionData === null) {\n        return;\n    }\n\n    const { node } = suggestionData;\n\n    // for a command, we know we start at the beginning of the text node, so build the replacement\n    // string (note trailing space) and manually adjust the node's textcontent\n    const newContent = `${replacementText} `;\n    node.textContent = newContent;\n\n    // then set the cursor to the end of the node, update the `content` state in the usePlainTextListeners\n    // hook and clear the suggestion from state\n    document.getSelection()?.setBaseAndExtent(node, newContent.length, node, newContent.length);\n    setText(newContent);\n    setSuggestionData(null);\n}\n\n/**\n * Replaces the relevant part of the editor text, replacing the plain text emoitcon with the suggested emoji.\n *\n * @param suggestionData - representation of the part of the DOM that will be replaced\n * @param setSuggestionData - setter function to set the suggestion state\n * @param setText - setter function to set the content of the composer\n */\nexport function processEmojiReplacement(\n    suggestionData: SuggestionState,\n    setSuggestionData: React.Dispatch<React.SetStateAction<SuggestionState>>,\n    setText: (text?: string) => void,\n): void {\n    // if we do not have a suggestion of the correct type, return early\n    if (suggestionData === null || suggestionData.mappedSuggestion.type !== `custom`) {\n        return;\n    }\n    const { node, mappedSuggestion } = suggestionData;\n    const existingContent = node.textContent;\n\n    if (existingContent == null) {\n        return;\n    }\n\n    // replace the emoticon with the suggesed emoji\n    const newContent =\n        existingContent.slice(0, suggestionData.startOffset) +\n        mappedSuggestion.text +\n        existingContent.slice(suggestionData.endOffset);\n\n    node.textContent = newContent;\n\n    document.getSelection()?.setBaseAndExtent(node, newContent.length, node, newContent.length);\n    setText(newContent);\n    setSuggestionData(null);\n}\n\n/**\n * Given some text content from a node and the cursor position, find the word that the cursor is currently inside\n * and then test that word to see if it is a suggestion. Return the `MappedSuggestion` with start and end offsets if\n * the cursor is inside a valid suggestion, null otherwise.\n *\n * @param text - the text content of a node\n * @param offset - the current cursor offset position within the node\n * @param isFirstTextNode - whether or not the node is the first text node in the editor. Used to determine\n * if a command suggestion is found or not\n * @param isAutoReplaceEmojiEnabled - whether plain text emoticons should be auto replaced with emojis\n * @returns the `MappedSuggestion` along with its start and end offsets if found, otherwise null\n */\nexport function findSuggestionInText(\n    text: string,\n    offset: number,\n    isFirstTextNode: boolean,\n    isAutoReplaceEmojiEnabled?: boolean,\n): { mappedSuggestion: MappedSuggestion; startOffset: number; endOffset: number } | null {\n    // Return null early if the offset is outside the content\n    if (offset < 0 || offset > text.length) {\n        return null;\n    }\n\n    // Variables to keep track of the indices we will be slicing from and to in order to create\n    // a substring of the word that the cursor is currently inside\n    let startSliceIndex = offset;\n    let endSliceIndex = offset;\n\n    // Search backwards from the current cursor position to find the start index of the word\n    // containing the cursor\n    while (shouldDecrementStartIndex(text, startSliceIndex)) {\n        startSliceIndex--;\n    }\n\n    // Search forwards from the current cursor position to find the end index of the word\n    // containing the cursor\n    while (shouldIncrementEndIndex(text, endSliceIndex)) {\n        endSliceIndex++;\n    }\n\n    // Get the word at the cursor then check if it contains a suggestion or not\n    const wordAtCursor = text.slice(startSliceIndex, endSliceIndex);\n    const mappedSuggestion = getMappedSuggestion(wordAtCursor, isAutoReplaceEmojiEnabled);\n\n    /**\n     * If we have a word that could be a command, it is not a valid command if:\n     * - the node we're looking at isn't the first text node in the editor (adding paragraphs can\n     *   result in nested <p> tags inside the editor <div>)\n     * - the starting index is anything other than 0 (they can only appear at the start of a message)\n     * - there is more text following the command (eg `/spo asdf|` should not be interpreted as\n     *   something requiring autocomplete)\n     */\n    if (\n        mappedSuggestion === null ||\n        (mappedSuggestion.type === \"command\" &&\n            (!isFirstTextNode || startSliceIndex !== 0 || endSliceIndex !== text.length))\n    ) {\n        return null;\n    }\n\n    return { mappedSuggestion, startOffset: startSliceIndex, endOffset: startSliceIndex + wordAtCursor.length };\n}\n\n/**\n * Associated function for findSuggestionInText. Checks the character at the preceding index\n * to determine if the search loop should continue.\n *\n * @param text - text content to check for mentions or commands\n * @param index - the current index to check\n * @returns true if check should keep moving backwards, false otherwise\n */\nfunction shouldDecrementStartIndex(text: string, index: number): boolean {\n    // If the index is at or outside the beginning of the string, return false\n    if (index <= 0) return false;\n\n    // We are inside the string so can guarantee that there is a preceding character\n    // Keep searching backwards if the preceding character is not a space\n    return !/\\s/.test(text[index - 1]);\n}\n\n/**\n * Associated function for findSuggestionInText. Checks the character at the current index\n * to determine if the search loop should continue.\n *\n * @param text - text content to check for mentions or commands\n * @param index - the current index to check\n * @returns true if check should keep moving forwards, false otherwise\n */\nfunction shouldIncrementEndIndex(text: string, index: number): boolean {\n    // If the index is at or outside the end of the string, return false\n    if (index >= text.length) return false;\n\n    // Keep searching forwards if the current character is not a space\n    return !/\\s/.test(text[index]);\n}\n\n/**\n * Given a string, return a `MappedSuggestion` if the string contains a suggestion. Otherwise return null.\n *\n * @param text - string to check for a suggestion\n * @param isAutoReplaceEmojiEnabled - whether plain text emoticons should be auto replaced with emojis\n * @returns a `MappedSuggestion` if a suggestion is present, null otherwise\n */\nexport function getMappedSuggestion(text: string, isAutoReplaceEmojiEnabled?: boolean): MappedSuggestion | null {\n    if (isAutoReplaceEmojiEnabled) {\n        // variations of plaintext emoitcons(E.g. :P vs :p vs :-P) are handled upstream by the emojibase-bindings/emojibase libraries.\n        // See rules for variations here https://github.com/milesj/emojibase/blob/master/packages/core/src/generateEmoticonPermutations.ts#L3-L32\n        const emoji = EMOTICON_TO_EMOJI.get(text);\n        if (emoji?.unicode) {\n            return { keyChar: \"\", text: emoji.unicode, type: \"custom\" };\n        }\n    }\n\n    const firstChar = text.charAt(0);\n    const restOfString = text.slice(1);\n\n    switch (firstChar) {\n        case \"/\":\n            return { keyChar: firstChar, text: restOfString, type: \"command\" };\n        case \"#\":\n        case \"@\":\n            return { keyChar: firstChar, text: restOfString, type: \"mention\" };\n        default:\n            return null;\n    }\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport { KeyboardEvent, RefObject, SyntheticEvent, useCallback, useRef, useState } from \"react\";\nimport { AllowedMentionAttributes, MappedSuggestion } from \"@vector-im/matrix-wysiwyg\";\nimport { IEventRelation } from \"matrix-js-sdk/src/matrix\";\n\nimport { useSettingValue } from \"../../../../../hooks/useSettings\";\nimport { IS_MAC, Key } from \"../../../../../Keyboard\";\nimport Autocomplete from \"../../Autocomplete\";\nimport { handleClipboardEvent, handleEventWithAutocomplete, isEventToHandleAsClipboardEvent } from \"./utils\";\nimport { useSuggestion } from \"./useSuggestion\";\nimport { isNotNull, isNotUndefined } from \"../../../../../Typeguards\";\nimport { useMatrixClientContext } from \"../../../../../contexts/MatrixClientContext\";\nimport { useScopedRoomContext } from \"../../../../../contexts/ScopedRoomContext.tsx\";\n\nfunction isDivElement(target: EventTarget): target is HTMLDivElement {\n    return target instanceof HTMLDivElement;\n}\n\n/**\n * React hook which generates all of the listeners and the ref to be attached to the editor.\n *\n * Also returns pieces of state and utility functions that are required for use in other hooks\n * and by the autocomplete component.\n *\n * @param initialContent - the content of the editor when it is first mounted\n * @param onChange - called whenever there is change in the editor content\n * @param onSend - called whenever the user sends the message\n * @param eventRelation - used to send the event to the correct place eg timeline vs thread\n * @param isAutoReplaceEmojiEnabled - whether plain text emoticons should be auto replaced with emojis\n * @returns\n * - `ref`: a ref object which the caller must attach to the HTML `div` node for the editor\n * * `autocompleteRef`: a ref object which the caller must attach to the autocomplete component\n * - `content`: state representing the editor's current text content\n * - `setContent`: the setter function for `content`\n * - `onInput`, `onPaste`, `onKeyDown`: handlers for input, paste and keyDown events\n * - the output from the {@link useSuggestion} hook\n */\nexport function usePlainTextListeners(\n    initialContent?: string,\n    onChange?: (content: string) => void,\n    onSend?: () => void,\n    eventRelation?: IEventRelation,\n    isAutoReplaceEmojiEnabled?: boolean,\n): {\n    ref: RefObject<HTMLDivElement>;\n    autocompleteRef: React.RefObject<Autocomplete>;\n    content?: string;\n    onBeforeInput(event: SyntheticEvent<HTMLDivElement, InputEvent | ClipboardEvent>): void;\n    onInput(event: SyntheticEvent<HTMLDivElement, InputEvent | ClipboardEvent>): void;\n    onPaste(event: SyntheticEvent<HTMLDivElement, InputEvent | ClipboardEvent>): void;\n    onKeyDown(event: KeyboardEvent<HTMLDivElement>): void;\n    setContent(text?: string): void;\n    handleMention: (link: string, text: string, attributes: AllowedMentionAttributes) => void;\n    handleAtRoomMention: (attributes: AllowedMentionAttributes) => void;\n    handleCommand: (text: string) => void;\n    onSelect: (event: SyntheticEvent<HTMLDivElement>) => void;\n    suggestion: MappedSuggestion | null;\n} {\n    const roomContext = useScopedRoomContext(\"room\", \"timelineRenderingType\", \"replyToEvent\");\n    const mxClient = useMatrixClientContext();\n\n    const ref = useRef<HTMLDivElement | null>(null);\n    const autocompleteRef = useRef<Autocomplete | null>(null);\n    const [content, setContent] = useState<string | undefined>(initialContent);\n\n    const send = useCallback(() => {\n        if (ref.current) {\n            ref.current.innerHTML = \"\";\n        }\n        onSend?.();\n    }, [ref, onSend]);\n\n    const setText = useCallback(\n        (text?: string) => {\n            if (isNotUndefined(text)) {\n                setContent(text);\n                onChange?.(text);\n            } else if (isNotNull(ref) && isNotNull(ref.current)) {\n                // if called with no argument, read the current innerHTML from the ref and amend it as per `onInput`\n                const currentRefContent = ref.current.innerHTML;\n                setContent(currentRefContent);\n                onChange?.(currentRefContent);\n            }\n        },\n        [onChange, ref],\n    );\n\n    // For separation of concerns, the suggestion handling is kept in a separate hook but is\n    // nested here because we do need to be able to update the `content` state in this hook\n    // when a user selects a suggestion from the autocomplete menu\n    const { suggestion, onSelect, handleCommand, handleMention, handleAtRoomMention, handleEmojiReplacement } =\n        useSuggestion(ref, setText, isAutoReplaceEmojiEnabled);\n\n    const onInput = useCallback(\n        (event: SyntheticEvent<HTMLDivElement, InputEvent | ClipboardEvent>) => {\n            if (isDivElement(event.target)) {\n                setText(event.target.innerHTML);\n            }\n        },\n        [setText],\n    );\n\n    const onPaste = useCallback(\n        (event: SyntheticEvent<HTMLDivElement, InputEvent | ClipboardEvent>) => {\n            const { nativeEvent } = event;\n            let imagePasteWasHandled = false;\n\n            if (isEventToHandleAsClipboardEvent(nativeEvent)) {\n                const data =\n                    nativeEvent instanceof ClipboardEvent ? nativeEvent.clipboardData : nativeEvent.dataTransfer;\n                imagePasteWasHandled = handleClipboardEvent(nativeEvent, data, roomContext, mxClient, eventRelation);\n            }\n\n            // prevent default behaviour and skip call to onInput if the image paste event was handled\n            if (imagePasteWasHandled) {\n                event.preventDefault();\n            } else {\n                onInput(event);\n            }\n        },\n        [eventRelation, mxClient, onInput, roomContext],\n    );\n\n    const enterShouldSend = !useSettingValue<boolean>(\"MessageComposerInput.ctrlEnterToSend\");\n    const onKeyDown = useCallback(\n        (event: KeyboardEvent<HTMLDivElement>) => {\n            // we need autocomplete to take priority when it is open for using enter to select\n            const isHandledByAutocomplete = handleEventWithAutocomplete(autocompleteRef, event);\n            if (isHandledByAutocomplete) {\n                return;\n            }\n            // handle accepting of plain text emojicon to emoji replacement\n            if (event.key == Key.ENTER || event.key == Key.SPACE) {\n                handleEmojiReplacement();\n            }\n\n            // resume regular flow\n            if (event.key === Key.ENTER) {\n                // TODO use getKeyBindingsManager().getMessageComposerAction(event) like in useInputEventProcessor\n                const sendModifierIsPressed = IS_MAC ? event.metaKey : event.ctrlKey;\n\n                // if enter should send, send if the user is not pushing shift\n                if (enterShouldSend && !event.shiftKey) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    send();\n                }\n\n                // if enter should not send, send only if the user is pushing ctrl/cmd\n                if (!enterShouldSend && sendModifierIsPressed) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    send();\n                }\n            }\n        },\n        [autocompleteRef, enterShouldSend, send, handleEmojiReplacement],\n    );\n\n    return {\n        ref,\n        autocompleteRef,\n        onBeforeInput: onPaste,\n        onInput,\n        onPaste,\n        onKeyDown,\n        content,\n        setContent: setText,\n        suggestion,\n        onSelect,\n        handleCommand,\n        handleMention,\n        handleAtRoomMention,\n    };\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport classNames from \"classnames\";\nimport { IEventRelation } from \"matrix-js-sdk/src/matrix\";\nimport React, { MutableRefObject, ReactNode } from \"react\";\n\nimport { useComposerFunctions } from \"../hooks/useComposerFunctions\";\nimport { useIsFocused } from \"../hooks/useIsFocused\";\nimport { usePlainTextInitialization } from \"../hooks/usePlainTextInitialization\";\nimport { usePlainTextListeners } from \"../hooks/usePlainTextListeners\";\nimport { useSetCursorPosition } from \"../hooks/useSetCursorPosition\";\nimport { ComposerFunctions } from \"../types\";\nimport { Editor } from \"./Editor\";\nimport { WysiwygAutocomplete } from \"./WysiwygAutocomplete\";\nimport { useSettingValue } from \"../../../../../hooks/useSettings\";\n\ninterface PlainTextComposerProps {\n    disabled?: boolean;\n    onChange?: (content: string) => void;\n    onSend?: () => void;\n    placeholder?: string;\n    initialContent?: string;\n    className?: string;\n    leftComponent?: ReactNode;\n    rightComponent?: ReactNode;\n    children?: (ref: MutableRefObject<HTMLDivElement | null>, composerFunctions: ComposerFunctions) => ReactNode;\n    eventRelation?: IEventRelation;\n}\n\nexport function PlainTextComposer({\n    className,\n    disabled = false,\n    onSend,\n    onChange,\n    children,\n    placeholder,\n    initialContent,\n    leftComponent,\n    rightComponent,\n    eventRelation,\n}: PlainTextComposerProps): JSX.Element {\n    const isAutoReplaceEmojiEnabled = useSettingValue<boolean>(\"MessageComposerInput.autoReplaceEmoji\");\n    const {\n        ref: editorRef,\n        autocompleteRef,\n        onBeforeInput,\n        onInput,\n        onPaste,\n        onKeyDown,\n        content,\n        setContent,\n        suggestion,\n        onSelect,\n        handleCommand,\n        handleMention,\n        handleAtRoomMention,\n    } = usePlainTextListeners(initialContent, onChange, onSend, eventRelation, isAutoReplaceEmojiEnabled);\n    const composerFunctions = useComposerFunctions(editorRef, setContent);\n    usePlainTextInitialization(initialContent, editorRef);\n    useSetCursorPosition(disabled, editorRef);\n    const { isFocused, onFocus } = useIsFocused();\n    const computedPlaceholder = (!content && placeholder) || undefined;\n    return (\n        <div\n            data-testid=\"PlainTextComposer\"\n            className={classNames(className, { [`${className}-focused`]: isFocused })}\n            onFocus={onFocus}\n            onBlur={onFocus}\n            onBeforeInput={onBeforeInput}\n            onInput={onInput}\n            onPaste={onPaste}\n            onKeyDown={onKeyDown}\n            onSelect={onSelect}\n        >\n            <WysiwygAutocomplete\n                ref={autocompleteRef}\n                suggestion={suggestion}\n                handleMention={handleMention}\n                handleCommand={handleCommand}\n                handleAtRoomMention={handleAtRoomMention}\n            />\n            <Editor\n                ref={editorRef}\n                disabled={disabled}\n                leftComponent={leftComponent}\n                rightComponent={rightComponent}\n                placeholder={computedPlaceholder}\n            />\n            {children?.(editorRef, composerFunctions)}\n        </div>\n    );\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport { RefObject, useMemo } from \"react\";\n\nimport { setSelection } from \"../utils/selection\";\n\nexport function useComposerFunctions(\n    ref: RefObject<HTMLDivElement>,\n    setContent: (content: string) => void,\n): {\n    clear(): void;\n    insertText(text: string): void;\n} {\n    return useMemo(\n        () => ({\n            clear: () => {\n                if (ref.current) {\n                    ref.current.innerHTML = \"\";\n                }\n            },\n            insertText: (text: string) => {\n                const selection = document.getSelection();\n\n                if (ref.current && selection) {\n                    const content = ref.current.innerHTML;\n                    const { anchorOffset, focusOffset } = selection;\n                    ref.current.innerHTML = `${content.slice(0, anchorOffset)}${text}${content.slice(focusOffset)}`;\n                    setSelection({\n                        anchorNode: ref.current.firstChild,\n                        anchorOffset: anchorOffset + text.length,\n                        focusNode: ref.current.firstChild,\n                        focusOffset: focusOffset + text.length,\n                        isForward: true,\n                    });\n                    setContent(ref.current.innerHTML);\n                }\n            },\n        }),\n        [ref, setContent],\n    );\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport { RefObject, useEffect } from \"react\";\n\nexport function usePlainTextInitialization(initialContent = \"\", ref: RefObject<HTMLElement>): void {\n    useEffect(() => {\n        // always read and write the ref.current using .innerHTML for consistency in linebreak and HTML entity handling\n        if (ref.current) {\n            ref.current.innerHTML = initialContent;\n        }\n    }, [ref, initialContent]);\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport React from \"react\";\n\nimport { MenuProps } from \"../../../../structures/ContextMenu\";\nimport { EmojiButton } from \"../../EmojiButton\";\nimport dis from \"../../../../../dispatcher/dispatcher\";\nimport { ComposerInsertPayload } from \"../../../../../dispatcher/payloads/ComposerInsertPayload\";\nimport { Action } from \"../../../../../dispatcher/actions\";\nimport { useScopedRoomContext } from \"../../../../../contexts/ScopedRoomContext.tsx\";\n\ninterface EmojiProps {\n    menuPosition: MenuProps;\n}\n\nexport function Emoji({ menuPosition }: EmojiProps): JSX.Element {\n    const roomContext = useScopedRoomContext(\"timelineRenderingType\");\n\n    return (\n        <EmojiButton\n            menuPosition={menuPosition}\n            addEmoji={(emoji) => {\n                dis.dispatch<ComposerInsertPayload>({\n                    action: Action.ComposerInsert,\n                    text: emoji,\n                    timelineRenderingType: roomContext.timelineRenderingType,\n                });\n                return true;\n            }}\n        />\n    );\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport React, { ForwardedRef, forwardRef, MutableRefObject, useRef } from \"react\";\nimport { IEventRelation } from \"matrix-js-sdk/src/matrix\";\n\nimport { useWysiwygSendActionHandler } from \"./hooks/useWysiwygSendActionHandler\";\nimport { WysiwygComposer } from \"./components/WysiwygComposer\";\nimport { PlainTextComposer } from \"./components/PlainTextComposer\";\nimport { ComposerFunctions } from \"./types\";\nimport { E2EStatus } from \"../../../../utils/ShieldUtils\";\nimport E2EIcon from \"../E2EIcon\";\nimport { MenuProps } from \"../../../structures/ContextMenu\";\nimport { Emoji } from \"./components/Emoji\";\nimport { ComposerContext, getDefaultContextValue } from \"./ComposerContext\";\n\ninterface ContentProps {\n    disabled?: boolean;\n    composerFunctions: ComposerFunctions;\n}\n\nconst Content = forwardRef<HTMLElement, ContentProps>(function Content(\n    { disabled = false, composerFunctions }: ContentProps,\n    forwardRef: ForwardedRef<HTMLElement>,\n) {\n    useWysiwygSendActionHandler(disabled, forwardRef as MutableRefObject<HTMLElement>, composerFunctions);\n    return null;\n});\n\nexport interface SendWysiwygComposerProps {\n    initialContent?: string;\n    isRichTextEnabled: boolean;\n    placeholder?: string;\n    disabled?: boolean;\n    e2eStatus?: E2EStatus;\n    onChange: (content: string) => void;\n    onSend: () => void;\n    menuPosition: MenuProps;\n    eventRelation?: IEventRelation;\n}\n\n// Default needed for React.lazy\nexport default function SendWysiwygComposer({\n    isRichTextEnabled,\n    e2eStatus,\n    menuPosition,\n    ...props\n}: SendWysiwygComposerProps): JSX.Element {\n    const Composer = isRichTextEnabled ? WysiwygComposer : PlainTextComposer;\n    const defaultContextValue = useRef(getDefaultContextValue({ eventRelation: props.eventRelation }));\n\n    return (\n        <ComposerContext.Provider value={defaultContextValue.current}>\n            <Composer\n                className=\"mx_SendWysiwygComposer\"\n                leftComponent={e2eStatus && <E2EIcon status={e2eStatus} />}\n                rightComponent={<Emoji menuPosition={menuPosition} />}\n                {...props}\n            >\n                {(ref, composerFunctions) => (\n                    <Content disabled={props.disabled} ref={ref} composerFunctions={composerFunctions} />\n                )}\n            </Composer>\n        </ComposerContext.Provider>\n    );\n}\n","/*\nCopyright 2024 New Vector Ltd.\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport { MutableRefObject, useCallback, useRef } from \"react\";\n\nimport defaultDispatcher from \"../../../../../dispatcher/dispatcher\";\nimport { Action } from \"../../../../../dispatcher/actions\";\nimport { ActionPayload } from \"../../../../../dispatcher/payloads\";\nimport { TimelineRenderingType } from \"../../../../../contexts/RoomContext\";\nimport { useDispatcher } from \"../../../../../hooks/useDispatcher\";\nimport { focusComposer } from \"./utils\";\nimport { ComposerFunctions } from \"../types\";\nimport { ComposerType } from \"../../../../../dispatcher/payloads/ComposerInsertPayload\";\nimport { useComposerContext } from \"../ComposerContext\";\nimport { setSelection } from \"../utils/selection\";\nimport { useScopedRoomContext } from \"../../../../../contexts/ScopedRoomContext.tsx\";\n\nexport function useWysiwygSendActionHandler(\n    disabled: boolean,\n    composerElement: MutableRefObject<HTMLElement>,\n    composerFunctions: ComposerFunctions,\n): void {\n    const roomContext = useScopedRoomContext(\"timelineRenderingType\");\n    const composerContext = useComposerContext();\n    const timeoutId = useRef<number | null>(null);\n\n    const handler = useCallback(\n        (payload: ActionPayload) => {\n            // don't let the user into the composer if it is disabled - all of these branches lead\n            // to the cursor being in the composer\n            if (disabled || !composerElement?.current) return;\n\n            const context = payload.context ?? TimelineRenderingType.Room;\n\n            switch (payload.action) {\n                case \"reply_to_event\":\n                case Action.FocusAComposer:\n                case Action.FocusSendMessageComposer:\n                    focusComposer(composerElement, context, roomContext, timeoutId);\n                    break;\n                case Action.ClearAndFocusSendMessageComposer:\n                    // When a thread is opened, prevent the main composer to steal the thread composer focus\n                    if (payload.timelineRenderingType !== roomContext.timelineRenderingType) break;\n\n                    composerFunctions.clear();\n                    focusComposer(composerElement, context, roomContext, timeoutId);\n                    break;\n                case Action.ComposerInsert:\n                    if (payload.timelineRenderingType !== roomContext.timelineRenderingType) break;\n                    if (payload.composerType !== ComposerType.Send) break;\n\n                    if (payload.userId) {\n                        // TODO insert mention - see SendMessageComposer\n                    } else if (payload.event) {\n                        // TODO insert quote message - see SendMessageComposer\n                    } else if (payload.text) {\n                        setSelection(composerContext.selection).then(() => composerFunctions.insertText(payload.text));\n                    }\n                    break;\n            }\n        },\n        [disabled, composerElement, roomContext, composerFunctions, composerContext],\n    );\n\n    useDispatcher(defaultDispatcher, handler);\n}\n"],"names":["CollapsibleButton","_ref","title","children","className","iconClassName","inputRef","props","_objectWithoutProperties","_excluded","useContext","OverflowMenuContext","React","IconizedContextMenuOption","_extends","label","AccessibleButton","classNames","ref","EmojiButton","addEmoji","menuPosition","overflowMenuCloser","menuDisplayed","button","openMenu","closeMenu","useContextMenu","contextMenu","current","position","aboveLeftOf","getBoundingClientRect","onFinished","ContextMenu","managed","EmojiPicker","onChoose","computedClassName","mx_EmojiButton_highlight","onClick","_t","createContext","emojiButton","key","uploadButton","UploadButton","UploadButtonContext","UploadButtonContextProvider","roomId","relation","cli","MatrixClientContext","roomContext","useScopedRoomContext","uploadInput","useRef","onUploadClick","_uploadInput$current","isGuest","dis","dispatch","action","click","useDispatcher","payload","timelineRenderingType","context","Provider","value","type","style","display","multiple","chromeFileInputFix","onChange","ev","_ev$target$files","target","files","length","ContentMessages","sharedInstance","sendContentListToRoom","Array","from","uploadButtonFn","showStickersButton","id","setStickerPickerOpen","isStickerPickerOpen","voiceRecordingButton","narrow","onRecordStartEndClick","pollButton","room","PollButton","constructor","args","_defineProperty","_this$context","this","call","currentState","maySendEvent","M_POLL_START","name","MatrixClientPeg","safeGet","getSafeUserId","_this$props$relation","threadId","rel_type","THREAD_RELATION_TYPE","event_id","undefined","Modal","createDialog","PollCreateDialog","ErrorDialog","description","render","_this$props$relation2","onCreateClick","showLocationButton","matrixClient","sender","getMember","LocationButton","ComposerModeButton","isRichTextEnabled","mx_MessageComposer_plain_text","mx_MessageComposer_rich_text","isWysiwygLabEnabled","useSettingValue","haveRecording","mainButtons","moreButtons","onComposerModeClick","showPollsButton","filterBoolean","moreOptionsClasses","mx_MessageComposer_button","mx_MessageComposer_buttonMenu","mx_MessageComposer_closeButtonMenu","isMenuOpen","toggleButtonMenu","IconizedContextMenu","wrapperClassName","compact","IconizedContextMenuOptionList","useSuggestion","editorRef","setText","isAutoReplaceEmojiEnabled","_suggestionData$mappe","suggestionData","setSuggestionData0","useState","setSuggestionData","logger","log","Function","mappedSuggestion","keyChar","text","suggestion","handleCommand","replacementText","_document$getSelectio2","node","newContent","textContent","document","getSelection","setBaseAndExtent","processCommand","handleMention","href","displayName","attributes","processMention","handleAtRoomMention","handleEmojiReplacement","_document$getSelectio3","existingContent","slice","startOffset","endOffset","processEmojiReplacement","onSelect","_selection$anchorNode","selection","isCollapsed","anchorNode","nodeName","currentNode","anchorOffset","currentOffset","firstTextNode","createNodeIterator","NodeFilter","SHOW_TEXT","nextNode","isFirstTextNode","foundSuggestion","offset","startSliceIndex","endSliceIndex","shouldDecrementStartIndex","shouldIncrementEndIndex","wordAtCursor","emoji","EMOTICON_TO_EMOJI","get","unicode","firstChar","charAt","restOfString","getMappedSuggestion","findSuggestionInText","processSelectionChange","_node$textContent","_node$textContent$sli","_node$textContent2","_document$getSelectio","linkElement","createElement","linkTextNode","createTextNode","setAttribute","attr","entries","appendChild","leadingTextNode","trailingTextNode","parentNode","isNotNull","insertBefore","removeChild","index","test","usePlainTextListeners","initialContent","onSend","eventRelation","mxClient","useMatrixClientContext","autocompleteRef","content","setContent","send","useCallback","innerHTML","isNotUndefined","currentRefContent","onInput","event","HTMLDivElement","onPaste","nativeEvent","imagePasteWasHandled","isEventToHandleAsClipboardEvent","data","ClipboardEvent","clipboardData","dataTransfer","handleClipboardEvent","preventDefault","enterShouldSend","onKeyDown","handleEventWithAutocomplete","Key","ENTER","SPACE","sendModifierIsPressed","IS_MAC","metaKey","ctrlKey","shiftKey","stopPropagation","onBeforeInput","PlainTextComposer","disabled","placeholder","leftComponent","rightComponent","composerFunctions","useMemo","clear","insertText","focusOffset","setSelection","firstChild","focusNode","isForward","useComposerFunctions","useEffect","usePlainTextInitialization","useSetCursorPosition","isFocused","onFocus","useIsFocused","computedPlaceholder","onBlur","WysiwygAutocomplete","Editor","Emoji","Action","ComposerInsert","Content","forwardRef","composerElement","composerContext","useComposerContext","timeoutId","handler","_payload$context","TimelineRenderingType","Room","FocusAComposer","FocusSendMessageComposer","focusComposer","ClearAndFocusSendMessageComposer","composerType","ComposerType","Send","userId","then","defaultDispatcher","useWysiwygSendActionHandler","SendWysiwygComposer","e2eStatus","Composer","WysiwygComposer","defaultContextValue","getDefaultContextValue","ComposerContext","E2EIcon","status"],"sourceRoot":""}